<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/favicon.ico" />
    <!-- Preload is necessary because we show these images when we disconnect from the server,
    but at that point we cannot load these images from the server -->
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/gradient-yHQUC_QB.png" as="image" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/noise-60BoTA8O.png" as="image" />
    <!-- Preload the fonts -->
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/Lora-VariableFont_wght-B2ootaw-.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/PTSans-Regular-CxL0S8W7.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/PTSans-Bold-D9fedIX3.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/FiraMono-Regular-BTCkDNvf.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/FiraMono-Medium-DU3aDxX5.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/FiraMono-Bold-CLVRCuM9.ttf" as="font" crossorigin="anonymous" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="a marimo app" />
    <link rel="apple-touch-icon" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/apple-touch-icon.png" />
    <link rel="manifest" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/manifest.json" />

    <script data-marimo="true">
      function __resizeIframe(obj) {
        const scrollbarHeight = 20; // Max between windows, mac, and linux

        function setHeight() {
          // Guard against race condition where iframe isn't ready
          if (!obj.contentWindow?.document?.documentElement) {
            return;
          }
          const element = obj.contentWindow.document.documentElement;
          // If there is no vertical scrollbar, we don't need to resize the iframe
          if (element.scrollHeight === element.clientHeight) {
            return;
          }

          // Create a new height that includes the scrollbar height if it's visible
          const hasHorizontalScrollbar = element.scrollWidth > element.clientWidth;
          const newHeight = element.scrollHeight + (hasHorizontalScrollbar ? scrollbarHeight : 0);

          // Only update the height if it's different from the current height
          if (obj.style.height !== `${newHeight}px`) {
            obj.style.height = `${newHeight}px`;
          }
        }

        // Resize the iframe to the height of the content and bottom scrollbar height
        setHeight();

        // Resize the iframe when the content changes
        const resizeObserver = new ResizeObserver((_entries) => {
          setHeight();
        });
        // Only observe if iframe content is ready
        if (obj.contentWindow?.document?.body) {
          resizeObserver.observe(obj.contentWindow.document.body);
        }
      }
    </script>
    <marimo-filename hidden>ch02.py</marimo-filename>
    <!-- TODO(Trevor): Legacy, required by VS Code plugin. Remove when plugin is updated (see marimo/server/_templates/template.py) -->
    <marimo-version data-version="{{ version }}" hidden></marimo-version>
    <marimo-user-config data-config="{{ user_config }}" hidden></marimo-user-config>
    <marimo-server-token data-token="{{ server_token }}" hidden></marimo-server-token>
    <!-- /TODO -->
    <title>ch02</title>
    <script type="module" crossorigin crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/index-3OIHLLq_.js"></script>
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/preload-helper-g1IWzEZ-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/chunk-LvLJmgfZ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/react-XTZdWHwa.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/compiler-runtime-QczY1yfQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useEventListener-4mpeqPxW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/react-dom-BZDtXk6t.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/jsx-runtime-DUsrKwmN.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/Combination-D2HqSOvH.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/clsx-FpJB9huX.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/cn-Cs2e4A8T.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/menu-items-B57SjdWM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/hotkeys-Dh4gy4JD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/button-D8mnDDLX.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-Dj-O1Spr.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/createLucideIcon-BJ2I6csQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/check-CWbw3kKW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/select-CgZgQ5hV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/multi-map-D3NvLiI9.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/chevron-right-B_qBg_RU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dropdown-menu-Ciqx4yT-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/tooltip-DqNvr2Rw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/_Uint8Array-BGESiCQL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/_getTag-BWqNuuwU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/_baseIsEqual-C8v2yRqO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/jotai-D74Ef_p1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/invariant-Amh6wt4N.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/isArrayLikeObject-BkJc8lDE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/merge-5YNOh9ZD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/zod-BBqism5D.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/utils-x9KlwLm7.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/requests-THIDPq-F.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/once-BxRirs3K.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/toDate-Y5T6FHPx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/isSymbol-BGkTcW3U.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/toString-DlRqgfqz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/_baseSlice-BoaxdS7L.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/_hasUnicode-CNlKPr15.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useLifecycle-8fgb5Nue.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/capitalize-L9-XHPtm.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/ai-model-dropdown-CO52rzQt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/badge-Cm0WUI-_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/use-toast-DKTyV2AR.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/constants-BmIIVBf_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/Deferred-9HYzcD3r.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/config-CbG7e0K6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/uuid-B8w6pjWV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/DeferredRequestRegistry-DfLQSvoS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/connection-B11rCPnY.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useNonce-D8CLFIrY.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/capabilities-Bdlrhekp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/createReducer-VgoBNe3M.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-C3a_7WFa.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-0z0sEYV-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-BzfTz_Dx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-DmruaXMM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-DU0YrNRK.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-_bGPtAsk.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-DsSBESho.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-B2TjmP7E.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-BzDb7E9f.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/stex-C4ZxI0N3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/cjs-Ba5CQnxe.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/_arrayReduce-DdxhySYh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/type-kFt-n-jZ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/_baseProperty-D0ckTA0L.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/toNumber-GB_lFVaq.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/now-CAWn5i9V.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/debounce-Bgq-wc7M.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/toInteger-Cl1doThW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/main-CC_mbgxK.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/cells-DoKM12vd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/kbd-EdFdwHEs.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/renderShortcut-CLenKJO6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useEvent-l9BzRqpK.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useDeleteCell-BDBSmjLV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/lazy-Cbg8zRvU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/defaultLocale-8c1ixjJ_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/precisionRound-CQhbsDNz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/defaultLocale-BECdiY5x.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/vega-loader.browser-DZ31-605.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/tooltip-CSAGVmjx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/ErrorBoundary-6EjkHrSV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/alert-dialog-D9SwG8oA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dialog-BPIq0Dmw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useDebounce-C9S6xmGh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/numbers-BigybruE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/SSRProvider-DlZbKHsu.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/context-CO64Gasq.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useNumberFormatter-B5HAJDUq.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/usePress-DHxqjtDm.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/input-CVoLDDk-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/ImperativeModal-ameyIrhc.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/cell-link-BiAu_8pk.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/alert-D5BMn3Et.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/links-Iv0WhyKW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/state-i7G4J1VS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/MarimoErrorOutput-Bh7Bgl2Z.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/copy-BS3uwoaq.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/copy-DhmkXAPp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/copy-icon-Lyk2_Z8G.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/spinner-DpaQpaiI.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-D1pae9A2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/focus-CyxSol0W.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/popover-DZBXSGEz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useRunCells-DT1En-Te.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/mode-DKDAYLK9.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/purify.es-hXMlfS4W.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/RenderHTML-Dlz0Ew2i.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/table-CesNYRF-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/tabs-BjAbB8w_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/add-missing-import-DV1FOw9w.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useAsyncData-_-DLduEH.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useIframeCapabilities-r0LQMxAQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/LazyAnyLanguageCodeMirror-C7KtNlRp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/error-banner-C9tkg1MX.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/formats-C3exma5i.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useTheme-DpA-8Qyy.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/en-US-Lc4gASCJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/isValid-Cd_L_2Pm.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/maps-D4abje2p.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/shim-D-ElLTBO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/download-CCvBQ7qL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/extends-C2lJEiP_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/emotion-is-prop-valid.esm-c4A1huxA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useDateFormatter-BMdQ9MI_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/katex-BmfUoCWW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/marked.esm-idL59iHw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/chunk-T7OEMACY-CdGEwedE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/range-Bbli-TEL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/table-kHJ0xpFt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/Output-DxdWGPFi.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/name-cell-input-C6ZYU6mN.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useHotkey-B0ylhc2m.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-CqHWOZu2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-BcLYYUSi.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-BVXr6b5T.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-BrEX5EQl.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-CalRK9ms.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-Cc4T7UUX.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-D3MC5WiF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-DgaCIZAa.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-rqHtY98i.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-tj-jaP-y.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-w7c0BKrD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-CCZcRJI9.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-CrDb6akR.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/apl-BQt6lLuE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/asciiarmor-BjX7bs0j.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/asn1-xn1MtyoW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/brainfuck-BjO-UY1i.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/clike-DW9tQWfF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/clojure-BSW96HRx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/cmake-C7UlMfz3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/cobol-CyWIev3Y.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/coffeescript-DTvziYTK.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/commonlisp-yMdkdGMi.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/crystal-BGnoSp3z.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/css-D7fWzevp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/cypher-Cr1dl0Qf.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/d-C2bS5bA6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/diff-B2mHQyn6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dtd-Cy-lUE7p.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dylan-mm60grwk.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/ecl-Cqi05Wy1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/eiffel-FkvfLQq7.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/elm-Da5txHw0.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/erlang-CdnCEH5x.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/simple-mode-B185hCuE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/factor-CamlR8EJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/forth-UcMX0m31.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/fortran-DZ_vNVsP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/gas-CM88o6Zj.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/gherkin-BhrpTeN9.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/groovy-BFju68Wx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/haskell-CrWHY4et.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/haxe-1eKW-tbO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/idl-Do4AwvU2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/javascript-CTXZKRYd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/julia-BRynwHI4.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/livescript-ZmIBNA-I.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/lua-mUfZ-MRC.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/mathematica-Dil5dTHO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/mbox-Dnkn9wSr.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/mirc-auEWieOB.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/mllike-xVJsauJ8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/modelica-B8kajVDm.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/mscgen-Bsnta1jn.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/mumps-CMw16b5q.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/nsis-DwPdi8sw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/ntriples-O5lQxirn.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/octave-CMfAar-E.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/oz-CLRI9Qww.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/pascal-D2M_3HBx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/perl-B8lV7aKt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/pig-Bima2bfE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/powershell-v_t41ydu.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/properties-ChrStSby.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/protobuf-Bin6kmlf.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/pug-UWVdYLYW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/puppet-DYrtWvYn.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/python-BuKrulde.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/q-CrXUTiVN.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/r-Bk2Tiso2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/rpm-CmmZphz3.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/ruby-ElyOTVeQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/sas-jE3ZlG0K.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/scheme-CZF1tRbv.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/shell-LqT3ZqMa.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/sieve-y15yT7Pp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/smalltalk-pk5PvsMs.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/sparql-DTZ_gfPQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/stylus-CrGj0eNT.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/swift-tt3PlBbI.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/tcl-1P4b0GMJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/textile-BHDIuMYh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/toml-C8qoqk_i.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/troff-DMiF5Zmz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/ttcn-cfg-qLZtNU-E.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/ttcn-BAUp3RZn.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/turtle-BizIwmKv.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/vb-Bn_uCxNL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/vbscript-BTKW8Atx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/velocity-CcB05fpi.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/verilog-BWdtOJH8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/vhdl-CzFOaOHx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/webidl-DDEKCqSy.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/xquery-BcF6ZhQP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/yacas-BARQAiXa.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/z80-DO_Ep0iT.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/esm-DnNh7vdQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/objectWithoutPropertiesLoose-DDabolgJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/esm-Crqxhl3F.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/trash-Df8Wb7xS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/ConsoleOutput-D8ETq-cc.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/icons-BgmgMjOV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/blob-LiDbeYko.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/add-cell-with-ai-85tnyxYo.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/chart-no-axes-column-BrQ3B3xc.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/square-function-D5EEjILG.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/spec-DpllSlJD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useInstallPackage-BaAhpZlP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/column-preview-DGBk0umL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useAddCell-DYfGo4T8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/toggle-PGHtwx2G.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/api-CoLss8_O.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/globals-oV9pRUSB.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/share-DjbnD3WE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/memoize-DN0TMY36.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/get-CyLJYAfP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/_baseSet-CKSmZC_I.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/utilities.esm-DvrcU9Ky.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/floating-outline-DmCT2Mvg.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/eye-off-BUwXWtH0.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/plus-CiGrWbgb.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/readonly-python-code-CkaJ4Tks.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/file-video-camera-BGBfFNDn.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/file-text-O5IflCIn.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/file-CqXxt3_J.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/types-BMriRmf-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/label-4Nancvon.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/textarea-BnZHy5Jt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/circle-x-Cc9X6U_B.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/refresh-ccw-aU2rUkrI.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/trash-2-Du5ITnDv.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/form-600t_Civ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/field-Dov6YyOV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/switch-Ct8mUApv.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useBoolean-Dmwks1uh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/useDeepCompareMemoize-C8RdAYFq.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/types-D0WVpW93.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/prop-types-WJwGTMoZ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/es-DAmFxw3U.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/VisuallyHidden-RqykLBKh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/_baseFlatten-rM2FaX4x.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/hasIn-CE-pxQP-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/_basePickBy-LbasZ8ix.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/pick-FbHfDtcJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/send-LAFRRDPT.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/code-xml-DdSOsi73.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/download-Dmmu2U4a.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/globe-vMZtva7z.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/refresh-cw-BOc7UXm9.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/settings-DznrHqbd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/square-DhlBDqyx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/triangle-alert-Bf1kg4xT.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/dist-DL3W3q-2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/bundle.esm-C-9IAWQU.js">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/cells-wU8qigWB.css">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/Output-DUep6sC9.css">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/ConsoleOutput-BFFTcC5Y.css">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.18.4/dist/assets/index-CJU5NUvF.css">
  
<script data-marimo="true">
    window.__MARIMO_STATIC__ = {};
    window.__MARIMO_STATIC__.files = {};
</script>
</head>
  <body>
    <div id="root"></div>
    <!-- This is a portal for the data editor to render in -->
    <div id="portal" data-testid="glide-portal" style="position: fixed; left: 0; top: 0; z-index: 9999"></div>
    <script data-marimo="true">
      window.__MARIMO_MOUNT_CONFIG__ = {
            "filename": "ch02.py",
            "mode": "read",
            "version": "0.18.4",
            "serverToken": "static",
            "config": {"ai": {"models": {"custom_models": [], "displayed_models": []}}, "completion": {"activate_on_typing": true, "copilot": false}, "diagnostics": {"sql_linter": true}, "display": {"cell_output": "below", "code_editor_font_size": 14, "dataframes": "rich", "default_table_max_columns": 50, "default_table_page_size": 10, "default_width": "medium", "reference_highlighting": false, "theme": "light"}, "formatting": {"line_length": 79}, "keymap": {"overrides": {}, "preset": "default"}, "language_servers": {"pylsp": {"enable_flake8": false, "enable_mypy": true, "enable_pydocstyle": false, "enable_pyflakes": false, "enable_pylint": false, "enable_ruff": true, "enabled": false}}, "mcp": {"mcpServers": {}, "presets": []}, "package_management": {"manager": "uv"}, "runtime": {"auto_instantiate": false, "auto_reload": "off", "default_sql_output": "auto", "on_cell_change": "autorun", "output_max_bytes": 8000000, "reactive_tests": true, "std_stream_max_bytes": 1000000, "watcher_on_save": "lazy"}, "save": {"autosave": "after_delay", "autosave_delay": 1000, "format_on_save": false}, "server": {"browser": "default", "follow_symlink": false}, "snippets": {"custom_paths": [], "include_default_snippets": true}},
            "configOverrides": {},
            "appConfig": {"sql_output": "auto", "width": "medium"},
            "view": {"showAppCode": true},
            "notebook": {"cells": [{"code": "import importlib\nimport re\nfrom importlib.metadata import version\nfrom pathlib import Path\n\nimport marimo as mo\nimport requests\nimport tiktoken\nimport torch\nfrom torch.utils.data import DataLoader, Dataset", "code_hash": "b811c64f15a098eef1dbfb3bc7b139ba", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "setup", "name": "setup"}, {"code": "print(\"torch version:\", version(\"torch\"))\nprint(\"tiktoken version:\", version(\"tiktoken\"))", "code_hash": "221d4670dfdd8c1d81bc579d9cb793d4", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Hbol", "name": "_"}, {"code": "mo.md(r\"\"\"\n# Chapter 2: Working with Text Data\n\"\"\")", "code_hash": "8f2b5b49f2d6ba6ef6f6440e9b5764bd", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "MJUe", "name": "_"}, {"code": "mo.md(r\"\"\"\n## 2.2 Tokenizing text\n\"\"\")", "code_hash": "4c006fff43b47605c97c5eb9aeb5cf7f", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "vblA", "name": "_"}, {"code": "mo.md(r\"\"\"\nDefine a downloader function for the novel \"The Verdict\" that allows to be used for traning.\n\"\"\")", "code_hash": "c644ef17d9e8447e39d780fd6026347e", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "bkHC", "name": "_"}, {"code": "def download_verdict_data():\n    project_root = Path(__file__).parent.parent.parent\n    data_root = project_root / \"data\"\n    data_root.mkdir(parents=True, exist_ok=True)\n\n    file_path = data_root / \"the-verdict.txt\"\n    if file_path.exists():\n        print(f\"Data file already exists at {file_path}. Skipping download.\")\n    else:\n        data_url = \"https://raw.githubusercontent.com/rasbt/LLMs-from-scratch/main/ch02/01_main-chapter-code/the-verdict.txt\"\n        response = requests.get(data_url, timeout=30)\n        response.raise_for_status()\n        text_data = response.text\n        with open(file_path, \"w\", encoding=\"utf-8\") as file:\n            file.write(text_data)\n    return file_path", "code_hash": "928d1a8cb9d9d9d2ee2f1b208e120435", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "lEQa", "name": "*download_verdict_data"}, {"code": "mo.md(r\"\"\"\nDownload and read the data.\n\"\"\")", "code_hash": "5620b08a6e70e5bbc0f1b7ddeab4759a", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "PKri", "name": "_"}, {"code": "verdict_file_path = download_verdict_data()\nwith open(verdict_file_path, \"r\", encoding=\"utf-8\") as f:\n    raw_text = f.read()\n\nprint(\"Total number of character:\", len(raw_text))\nprint(raw_text[:99])", "code_hash": "4e780d91494428b5256946b840f8f83c", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Xref", "name": "_"}, {"code": "mo.md(r\"\"\"\nSplit words by whitespace using regex.\n\"\"\")", "code_hash": "806fd6f1062019a88d02ec3df30c1d04", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "SFPL", "name": "_"}, {"code": "text_1 = \"Hello, world. This, is a test.\"\n_result = re.split(r\"(\\s)\", text_1)\nprint(_result)", "code_hash": "47612c8fa936b70b8681c13fc1081c1d", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "BYtC", "name": "_"}, {"code": "mo.md(r\"\"\"\nAdd period (.) and comma (,) separaters for it.\n\"\"\")", "code_hash": "6087dc09e326a8b47a7cbca4245f295a", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "RGSE", "name": "_"}, {"code": "result_1 = re.split(r\"([,.]|\\s)\", text_1)\nprint(result_1)", "code_hash": "f1a9c6be173306b038127fc083b0a4f1", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Kclp", "name": "_"}, {"code": "mo.md(r\"\"\"\nDelete whitespaces that is recognized as a separater if it is needed.\nStrip whitespace from each item and then filter out any empty strings.\n\"\"\")", "code_hash": "52742d4c1829344a2b387c5746e8cfea", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "emfo", "name": "_"}, {"code": "_result = [item for item in result_1 if item.strip()]\nprint(_result)", "code_hash": "067536247bc91ef7e9c14e23ad7ed89b", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Hstk", "name": "_"}, {"code": "mo.md(r\"\"\"\nTry another example includes symbols like hyphen (-) or question mark (?). These symbols also can be extracted by treating these as separaters.\n\"\"\")", "code_hash": "716de2d0f51757b1c87bb8854b0a6196", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "nWHF", "name": "_"}, {"code": "text_2 = \"Hello, world. Is this-- a test?\"\n\n_result = re.split(r'([,.:;?_!\"()\\']|--|\\s)', text_2)\n_result = [item.strip() for item in _result if item.strip()]\nprint(_result)", "code_hash": "e0fa30550d5c9ff49daf5538c21c14ca", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "iLit", "name": "_"}, {"code": "mo.md(r\"\"\"\nSplit The Verdict data whole.\n\"\"\")", "code_hash": "487fe9447ddf166222e048a3946d991c", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ZHCJ", "name": "_"}, {"code": "preprocessed = re.split(r'([,.:;?_!\"()\\']|--|\\s)', raw_text)\npreprocessed = [item.strip() for item in preprocessed if item.strip()]\nprint(f\"{preprocessed[:30]=}\")\nprint(f\"{len(preprocessed)=}\")", "code_hash": "a399b7d4c7d58e0892b627a86c375214", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ROlb", "name": "_"}, {"code": "mo.md(r\"\"\"\n## 2.3 Converting tokens into token IDs\n\"\"\")", "code_hash": "c12b1babadec4cfc4cb6caded15b7c7a", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "qnkX", "name": "_"}, {"code": "mo.md(r\"\"\"\nCreate unique list of tokens by using `set`, then sort it.\n\"\"\")", "code_hash": "dfa12e4a5e036c49aa84223eab5bf3b8", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "TqIu", "name": "_"}, {"code": "all_words = sorted(set(preprocessed))\n_vocab_size = len(all_words)\nprint(_vocab_size)", "code_hash": "72b9bfcc42358a509bf131d4c658b3da", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Vxnm", "name": "_"}, {"code": "mo.md(r\"\"\"\nCreate map (dictionary) from token to token ID, then show it.\n\"\"\")", "code_hash": "98ab0407f8df03fb179d8262c51d0331", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "DnEU", "name": "_"}, {"code": "vocab = {token: integer for integer, token in enumerate(all_words)}\nfor _i, _item in enumerate(vocab.items()):\n    print(_item)\n    if _i \u003E= 50:\n        break", "code_hash": "ea257066237ca121a72d9b750af6a44d", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ulZA", "name": "_"}, {"code": "mo.md(r\"\"\"\nDefine a simple tokenizer based on these, and implement not only encoder but also decoder by defining the inverse mapping.\n\"\"\")", "code_hash": "ac58c91420f4c297a9699e9b30890f2f", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ecfG", "name": "_"}, {"code": "class SimpleTokenizerV1:\n    def __init__(self, vocab):\n        self.str_to_int = vocab\n        # inverse mapping\n        self.int_to_str = {i: s for s, i in vocab.items()}\n\n    def encode(self, text):\n        # Split by specified punctuations and whitespace\n        preprocessed = re.split(r'([,.:;?_!\"()\\']|--|\\s)', text)\n        # Remove empty strings and whitespace-only strings\n        preprocessed = [item.strip() for item in preprocessed if item.strip()]\n        # Map to token IDs\n        ids = [self.str_to_int[s] for s in preprocessed]\n        return ids\n\n    def decode(self, ids):\n        # Map token IDs back to strings by joining with spaces\n        text = \" \".join([self.int_to_str[i] for i in ids])\n        # Replace spaces before the specified punctuations\n        text = re.sub(r'\\s+([,.?!\"()\\'])', r\"\\1\", text)\n        return text", "code_hash": "b6c481725481c9c62c36d424640bd94b", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Pvdt", "name": "*SimpleTokenizerV1"}, {"code": "mo.md(r\"\"\"\nApply the encoder process to a sentence from The Verdict.\n\"\"\")", "code_hash": "d2cc787969cb815f91dc8b5b83f601d8", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ZBYS", "name": "_"}, {"code": "simple_tokenizer = SimpleTokenizerV1(vocab)\n\ntext_3 = \"\"\"\"It's the last he painted, you know,\" \n           Mrs. Gisburn said with pardonable pride.\"\"\"\ntoken_ids_3 = simple_tokenizer.encode(text_3)\nprint(token_ids_3)", "code_hash": "bdf315624ec093cd400248fd3000eb14", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "aLJB", "name": "_"}, {"code": "mo.md(r\"\"\"\nTry decoding it to check whether it is invertive.\n\"\"\")", "code_hash": "b06d5372a3efc06d33f4dbf0e9895f9b", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "nHfw", "name": "_"}, {"code": "simple_tokenizer.decode(token_ids_3)", "code_hash": "aa5a76875e01c75affc6a3940b396d8f", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "xXTn", "name": "_"}, {"code": "mo.md(r\"\"\"\nCombine these.\n\"\"\")", "code_hash": "e4e290f6df1bc3999ef7bb2f4e7a15d2", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "AjVT", "name": "_"}, {"code": "simple_tokenizer.decode(simple_tokenizer.encode(text_3))", "code_hash": "ab86fa92838ab6fe8da4bae62c794147", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "pHFh", "name": "_"}, {"code": "mo.md(r\"\"\"\nWe cannot treat unknown words that are not included in the vocabulary. This will occur an error.\n\"\"\")", "code_hash": "26eefac673a38afebd45a4d95a6f62e9", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "NCOB", "name": "_"}, {"code": "text_4 = \"Hello, do you like tea. Is this-- a test?\"\n\nsimple_tokenizer.encode(text_4)", "code_hash": "4e7dee53fe9ca3ef1e339a895531715c", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "aqbW", "name": "_"}, {"code": "mo.md(r\"\"\"\n## 2.4 Adding special context tokens\n\"\"\")", "code_hash": "9dba180ab344b62c64055cbd382cf9be", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "TRpd", "name": "_"}, {"code": "mo.md(r\"\"\"\nTo fix the vocabulary issues, the special token for unknown words should be added as `unk`. The special token to combine multiple texts is also added as `endoftext`.\n\"\"\")", "code_hash": "a1551d8335269138eb3cbaad2daa0882", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "TXez", "name": "_"}, {"code": "all_tokens = sorted(list(set(preprocessed)))\nall_tokens.extend([\"\u003C|endoftext|\u003E\", \"\u003C|unk|\u003E\"])\n\nvocab_extended = {token: integer for integer, token in enumerate(all_tokens)}", "code_hash": "a1a299db1ab79b7c544c7171c753e4d4", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "dNNg", "name": "_"}, {"code": "mo.md(r\"\"\"\nThe total number of the vocabulary is increased $1130+2=1132$.\n\"\"\")", "code_hash": "850ddf4b9b5910bdb3932aa84b1f4f5d", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "yCnT", "name": "_"}, {"code": "len(vocab_extended.items())", "code_hash": "c77ec58a385eb394bec234a911c8a7c6", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "wlCL", "name": "_"}, {"code": "mo.md(r\"\"\"\nCheck the tail.\n\"\"\")", "code_hash": "bf19cd2d5800b550dd21e1aaf8614fc6", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "kqZH", "name": "_"}, {"code": "for _i, _item in enumerate(list(vocab_extended.items())[-5:]):\n    print(_item)", "code_hash": "d9c605999dcc12c20dede81d29e2ab0d", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "wAgl", "name": "_"}, {"code": "mo.md(r\"\"\"\nThis is updated simple tokenier includes the special tokens.\n\"\"\")", "code_hash": "70e5007f7947dd399df56d7d108792a5", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "rEll", "name": "_"}, {"code": "class SimpleTokenizerV2:\n    def __init__(self, vocab):\n        self.str_to_int = vocab\n        self.int_to_str = {i: s for s, i in vocab.items()}\n\n    def encode(self, text):\n        preprocessed = re.split(r'([,.:;?_!\"()\\']|--|\\s)', text)\n        preprocessed = [item.strip() for item in preprocessed if item.strip()]\n        # Handle unknown tokens\n        preprocessed = [\n            item if item in self.str_to_int else \"\u003C|unk|\u003E\" for item in preprocessed\n        ]\n\n        ids = [self.str_to_int[s] for s in preprocessed]\n        return ids\n\n    def decode(self, ids):\n        text = \" \".join([self.int_to_str[i] for i in ids])\n        # Replace spaces before the specified punctuations\n        text = re.sub(r'\\s+([,.:;?!\"()\\'])', r\"\\1\", text)\n        return text", "code_hash": "d8377cc00a65cbaa17ac6194965ed39e", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "dGlV", "name": "*SimpleTokenizerV2"}, {"code": "mo.md(r\"\"\"\nTry to tokenize concatenated texts by the special token.\n\"\"\")", "code_hash": "057cb48bd2dafeba41b8a3d6d7d27cbd", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "SdmI", "name": "_"}, {"code": "tokenizer_extended = SimpleTokenizerV2(vocab_extended)\n\n_text1 = \"Hello, do you like tea?\"\n_text2 = \"In the sunlit terraces of the palace.\"\n\ntext_extended = \" \u003C|endoftext|\u003E \".join((_text1, _text2))\n\nprint(text_extended)", "code_hash": "b2b3daa5c3a7e59bdbee5696b2a8781f", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "lgWD", "name": "_"}, {"code": "mo.md(r\"\"\"\nThen, tokenize it. You will see token ID 1130 and 1131 that are asigned for the special tokens.\n\"\"\")", "code_hash": "f3da786513b585d412483170ba342418", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "yOPj", "name": "_"}, {"code": "tokenizer_extended.encode(text_extended)", "code_hash": "325e071f7f4a3db4562cc7c7b7179d06", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "fwwy", "name": "_"}, {"code": "mo.md(r\"\"\"\nDecode it to check the tokenization.\n\"\"\")", "code_hash": "a20ed35700cfa3615b25ff7f9e835a15", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "LJZf", "name": "_"}, {"code": "tokenizer_extended.decode(tokenizer_extended.encode(text_extended))", "code_hash": "c17f4939b738cda59f2c115230c4d7ca", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "urSm", "name": "_"}, {"code": "mo.md(r\"\"\"\n## 2.5 BytePair encoding\n\"\"\")", "code_hash": "0c8908e51e6bf4a43f0fa882e89b591e", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "jxvo", "name": "_"}, {"code": "mo.md(r\"\"\"\nTo avoid unknown tokens, introduce byte pair encoding (BPE) by using tiktoken.\n\"\"\")", "code_hash": "f67d26b4f68f67e6e41a9e68266fcd09", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "mWxS", "name": "_"}, {"code": "print(\"tiktoken version:\", importlib.metadata.version(\"tiktoken\"))", "code_hash": "b7bdb952c4a41936bd41ee846d179a13", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "CcZR", "name": "_"}, {"code": "mo.md(r\"\"\"\nTry the tiktoken tokenizer for GPT2 model. The max token ID 50256 is assigned for `endoftext`.\n\"\"\")", "code_hash": "c06a1e36ae8f46076ba89450818608e2", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "YWSi", "name": "_"}, {"code": "bpe_tokenizer = tiktoken.get_encoding(\"gpt2\")\n\ntext_5 = (\n    \"Hello, do you like tea? \u003C|endoftext|\u003E In the sunlit terraces\"\n     \"of someunknownPlace.\"\n)\n\nbpe_token_id_5 = bpe_tokenizer.encode(text_5, allowed_special={\"\u003C|endoftext|\u003E\"})\n\nprint(bpe_token_id_5)", "code_hash": "e3a7b99ae792d7f7e06727d557219865", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "zlud", "name": "_"}, {"code": "mo.md(r\"\"\"\nCheck it by using the decoding. It encodes all tokens in unique manner by using subworkds and the combined words. So, this is invertive.\n\"\"\")", "code_hash": "c726e525f8da8242ec1515e02e374990", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "tZnO", "name": "_"}, {"code": "_strings = bpe_tokenizer.decode(bpe_token_id_5)\nprint(_strings)", "code_hash": "4df1be27003ced3b6a27eaf5f8166ead", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "xvXZ", "name": "_"}, {"code": "mo.md(r\"\"\"\nTo know BPE, see [this](../../third_party/LLMs-from-scratch/ch02/05_bpe-from-scratch/bpe-from-scratch.ipynb).\n\"\"\")", "code_hash": "5fc2e49699efb7ee03102d9a3c28852b", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "CLip", "name": "_"}, {"code": "mo.md(r\"\"\"\n## 2.6 Data sampling with a sliding window\n\"\"\")", "code_hash": "775ab3be1c72d33526fde08796f670bc", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "YECM", "name": "_"}, {"code": "mo.md(r\"\"\"\nUse BPE tokenizer for tokenization of The Verdict, and show the size of the all tokens.\n\"\"\")", "code_hash": "60e9ed1e714cb207b59f1739d2bdcc04", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "cEAS", "name": "_"}, {"code": "enc_text = bpe_tokenizer.encode(raw_text)\nprint(len(enc_text))", "code_hash": "d0ef41fca87026a2d5b7bb9d1bee2e0e", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "iXej", "name": "_"}, {"code": "mo.md(r\"\"\"\nDelete the beginning for a later demonstration.\n\"\"\")", "code_hash": "5177dadab4e683865f8980ae630b3501", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "EJmg", "name": "_"}, {"code": "enc_sample = enc_text[50:]", "code_hash": "1f178580c3a29740e9ec4700212be1a1", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "UmEG", "name": "_"}, {"code": "mo.md(r\"\"\"\nCreate learning pairs to predict next tokens. The task is predicting the `y` from the `x`.\n\"\"\")", "code_hash": "d25559a446eba525765e4f1c4c064dd9", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "vEBW", "name": "_"}, {"code": "context_size = 4\n\nx = enc_sample[:context_size]\ny = enc_sample[1:context_size+1]\n\nprint(f\"x: {x}\")\nprint(f\"y:      {y}\")", "code_hash": "ba3fd82064d4e55004a9f80c03434a68", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "kLmu", "name": "_"}, {"code": "mo.md(r\"\"\"\nThe mappings will be learned are these.\n\"\"\")", "code_hash": "d52d451224ff4dc14301f658aaa378cd", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "IpqN", "name": "_"}, {"code": "for _i in range(1, context_size+1):\n    _context = enc_sample[:_i]\n    _desired = enc_sample[_i]\n\n    print(_context, \"----\u003E\", _desired)", "code_hash": "4b3e026a88a7fa0948db74a664633fb2", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "dxZZ", "name": "_"}, {"code": "mo.md(r\"\"\"\nDecode these token IDs to check the words.\n\"\"\")", "code_hash": "9e621993327192529a10698ae99b8e50", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "dlnW", "name": "_"}, {"code": "for _i in range(1, context_size+1):\n    _context = enc_sample[:_i]\n    _desired = enc_sample[_i]\n\n    print(bpe_tokenizer.decode(_context), \"----\u003E\", bpe_tokenizer.decode([_desired]))", "code_hash": "a5bbe1774beeafc2d499900a76336917", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "TTti", "name": "_"}, {"code": "mo.md(r\"\"\"\nLet's define dataset for this by using PyTorch.\n\"\"\")", "code_hash": "a4316a2d5e96f771db61f331d5ec48db", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "RKFZ", "name": "_"}, {"code": "print(\"PyTorch version:\", torch.__version__)", "code_hash": "3cae89922448b73c1072ed81b9a6a159", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "IaQp", "name": "_"}, {"code": "mo.md(r\"\"\"\nTo define PyTorch dataset, we need to define special methods `__len__` and `__getitem__` for iterater use. We implement the indexing for tokenized tensor with chunks whose size is `max_length` with `stride` step size (sliding window).\n\"\"\")", "code_hash": "f4f284f9e09e71fb17873d892d72e554", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "IWgg", "name": "_"}, {"code": "class GPTDatasetV1(Dataset):\n    def __init__(self, txt, bpe_tokenizer, max_length, stride):\n        self.input_ids = []\n        self.target_ids = []\n\n        # Tokenize the entire text\n        token_ids = bpe_tokenizer.encode(txt, allowed_special={\"\u003C|endoftext|\u003E\"})\n        assert len(token_ids) \u003E max_length, (\n            \"Number of tokenized inputs must at least be equal to max_length+1\"\n        )\n\n        # Use a sliding window to chunk the book into overlapping sequences of max_length\n        for i in range(0, len(token_ids) - max_length, stride):\n            input_chunk = token_ids[i : i + max_length]\n            target_chunk = token_ids[i + 1 : i + max_length + 1]\n            self.input_ids.append(torch.tensor(input_chunk))\n            self.target_ids.append(torch.tensor(target_chunk))\n\n    def __len__(self):\n        return len(self.input_ids)\n\n    def __getitem__(self, idx):\n        return self.input_ids[idx], self.target_ids[idx]", "code_hash": "4861ccc76f2436d0377c5af8ccc8123e", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "fCoF", "name": "*GPTDatasetV1"}, {"code": "mo.md(r\"\"\"\nDefine a function to instantiate the dataloader class.\n\"\"\")", "code_hash": "21ab3e77bc69c7817060919892963014", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "LkGn", "name": "_"}, {"code": "def create_dataloader_v1(\n    txt,\n    batch_size=4,\n    max_length=256,\n    stride=128,\n    shuffle=True,\n    drop_last=True,\n    num_workers=0,\n):\n    # Initialize the tokenizer\n    bpe_tokenizer = tiktoken.get_encoding(\"gpt2\")\n\n    # Create dataset\n    dataset = GPTDatasetV1(txt, bpe_tokenizer, max_length, stride)\n\n    # Create dataloader\n    dataloader = DataLoader(\n        dataset,\n        batch_size=batch_size,\n        shuffle=shuffle,\n        drop_last=drop_last,\n        num_workers=num_workers,\n    )\n\n    return dataloader", "code_hash": "6fde38f6d1dcba250555540824213762", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "zVRe", "name": "*create_dataloader_v1"}, {"code": "mo.md(r\"\"\"\nFor debugging, define a decoder function for batches.\n\"\"\")", "code_hash": "3343621115915a0732649c769b899088", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "woaO", "name": "_"}, {"code": "def decode_batch(batch, tokenizer):\n    inputs, targets = batch\n    batch_size, seq_length = inputs.shape\n\n    decoded_inputs = []\n    decoded_targets = []\n\n    for i in range(batch_size):\n        input_ids = inputs[i].tolist()\n        target_ids = targets[i].tolist()\n\n        decoded_input = tokenizer.decode(input_ids)\n        decoded_target = tokenizer.decode(target_ids)\n\n        decoded_inputs.append(decoded_input)\n        decoded_targets.append(decoded_target)\n\n    return decoded_inputs, decoded_targets", "code_hash": "14c172be19288dd96099c0b293a4633f", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "HnMC", "name": "*decode_batch"}, {"code": "mo.md(r\"\"\"\nCall the function to check the data batches. The output should be the pair of input IDs and target IDs.\n\"\"\")", "code_hash": "ab6d86392b648d2ff793122f11b9388c", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "wadT", "name": "_"}, {"code": "_dataloader_s1 = create_dataloader_v1(\n    raw_text, batch_size=1, max_length=4, stride=1, shuffle=False\n)\n\ndata_iter_s1 = iter(_dataloader_s1)\n_first_batch = next(data_iter_s1)\nprint(f\"{_first_batch=}\")\n\n_inputs_decoded, _targets_decoded = decode_batch(_first_batch, bpe_tokenizer)\nprint(f\"{_inputs_decoded=}\")\nprint(f\"{_targets_decoded=}\")", "code_hash": "c3e1ce732bd0f23191a1988bf6c1c145", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "VCRE", "name": "_"}, {"code": "mo.md(r\"\"\"\nIterate again and check the next batch. You will see only 1 shifted tokens from the previous because of `stride=1`.\n\"\"\")", "code_hash": "370791cffe1de6dd33c2911655fbbda3", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "hgqU", "name": "_"}, {"code": "_second_batch = next(data_iter_s1)\nprint(f\"{_second_batch=}\")\n\n_inputs_decoded, _targets_decoded = decode_batch(_second_batch, bpe_tokenizer)\nprint(f\"{_inputs_decoded=}\")\nprint(f\"{_targets_decoded=}\")", "code_hash": "f2fdf5f12cc05bfb4b74dedb225a773d", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "PSUk", "name": "_"}, {"code": "mo.md(r\"\"\"\nTry larger batch size (`batch_size=8`) for robust training. To avoid overfitting, the stride is also increased (`stride=4`).\n\"\"\")", "code_hash": "1745f425f9315e279e4683dd7c08abe7", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "mfOT", "name": "_"}, {"code": "_dataloader_s4 = create_dataloader_v1(\n    raw_text, batch_size=8, max_length=4, stride=4, shuffle=False\n)\n\ndata_iter_s4 = iter(_dataloader_s4)\n_inputs, _targets = next(data_iter_s4)\nprint(\"Inputs:\\n\", _inputs)\nprint(\"\\nTargets:\\n\", _targets)\n\n_inputs_decoded, _targets_decoded = decode_batch((_inputs, _targets), bpe_tokenizer)\nprint(f\"{_inputs_decoded=}\")\nprint(f\"{_targets_decoded=}\")", "code_hash": "dd06a95c566fc2b679e22ede0e0148f1", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "vGiW", "name": "_"}, {"code": "mo.md(r\"\"\"\n## 2.7 Creating token embeddings\n\"\"\")", "code_hash": "69048aa7b2ee3cbf3a0923693c8ccc26", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "SYQT", "name": "_"}, {"code": "mo.md(r\"\"\"\nThis is an example for token embeddings that accepts 6-dimensional input as the vocabulary and outputs 3-dimensional embedding vector.\n\nThe embedding is represented by a matrix whose rows represents embedding vectors for each vocabularies.\n\nThe representation matrix can be trained.\n\"\"\")", "code_hash": "a3d2ff412cc003d3c7efb6aeff126b8b", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "bMrW", "name": "_"}, {"code": "_vocab_size = 6\n_output_dim = 3\n\ntorch.manual_seed(123)\n# randomly initizalize embedding layer\nembedding_layer = torch.nn.Embedding(_vocab_size, _output_dim)\nprint(embedding_layer.weight)", "code_hash": "51f6d7df63d7788c8859ebcf5af92577", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "PSQn", "name": "_"}, {"code": "mo.md(r\"\"\"\nLet's try the embedding for token ID 3.\n\"\"\")", "code_hash": "0c7f2db4f5f138b40620b47b1cdd4d11", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "OfTS", "name": "_"}, {"code": "print(embedding_layer(torch.tensor([3])))", "code_hash": "3ca5b94ed7bb620774c44e1d1995ad25", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "lQxp", "name": "_"}, {"code": "mo.md(r\"\"\"\nTry more embeddings. This is just referring the matrix as LUT (Look Up Table).\n\"\"\")", "code_hash": "a38fe0c5cd694295181e821dd51d3bcf", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Plbk", "name": "_"}, {"code": "_input_ids = torch.tensor([2, 3, 5, 1])\nprint(embedding_layer(_input_ids))", "code_hash": "1bf8ddd1a3f8211e8c213bdbd95eadbd", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "rSYo", "name": "_"}, {"code": "mo.md(r\"\"\"\n## 2.8 Encoding word positions\n\"\"\")", "code_hash": "a0703e403e44433a1900882327eb5d3b", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "HuZB", "name": "_"}, {"code": "mo.md(r\"\"\"\nTry positional encoding based on this configurations.\n\"\"\")", "code_hash": "e6624cd2e66b4341ce8582a70c7f3bc9", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "WfYj", "name": "_"}, {"code": "_vocab_size = 50257\noutput_dim = 256\n\ntoken_embedding_layer = torch.nn.Embedding(_vocab_size, output_dim)", "code_hash": "d567f9f631b45e9a8353cba9b37dd6db", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Ynfw", "name": "_"}, {"code": "max_length = 4\ndataloader = create_dataloader_v1(\n    raw_text, batch_size=8, max_length=max_length,\n    stride=max_length, shuffle=False\n)\ndata_iter = iter(dataloader)\ninputs, targets = next(data_iter)", "code_hash": "4dfedc2b3949c63bb88dc663380dffab", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "LqFA", "name": "_"}, {"code": "print(\"Token IDs:\\n\", inputs)\nprint(\"\\nInputs shape:\\n\", inputs.shape)", "code_hash": "a9f85c6b75e3ea544b0a1b1bec16a9d4", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "uDnK", "name": "_"}, {"code": "mo.md(r\"\"\"\nThen, these tokens are embedded to 256-dimensional manifold.\n\"\"\")", "code_hash": "76a828279ee6bc746434b4bc9495bdc3", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "aWBL", "name": "_"}, {"code": "token_embeddings = token_embedding_layer(inputs)\nprint(token_embeddings.shape)\n\n# uncomment \u0026 execute the following line to see how the embeddings look like\n# print(token_embeddings)", "code_hash": "0e54cef5de9f1e7096ffc04d6080b690", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "MIsd", "name": "_"}, {"code": "mo.md(r\"\"\"\nAbsolute positional embedding is also proceeded by using another `torch.nn.Embedding` layer.\n\"\"\")", "code_hash": "7a032648fa11b7dd07387ae18dfe407c", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "IrqS", "name": "_"}, {"code": "context_length = max_length\npos_embedding_layer = torch.nn.Embedding(context_length, output_dim)\n\n# uncomment \u0026 execute the following line to see how the embedding layer weights look like\nprint(pos_embedding_layer.weight)", "code_hash": "8180682017cd1bde28df2447a02df190", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Lpqv", "name": "_"}, {"code": "mo.md(r\"\"\"\nThen, indexes represents absolute positions are input to it. This can be also interpreted as LUT.\n\"\"\")", "code_hash": "ab99ab5e92dbd69053c464ae2e287d07", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "upgv", "name": "_"}, {"code": "pos_embeddings = pos_embedding_layer(torch.arange(max_length))\nprint(pos_embeddings.shape)\n\n# uncomment \u0026 execute the following line to see how the embeddings look like\nprint(pos_embeddings) ", "code_hash": "27abc817f810bcab5786e3a08cc0330e", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "WJUG", "name": "_"}, {"code": "mo.md(r\"\"\"\nThe absolute positional encoding is just adding these.\n\"\"\")", "code_hash": "5a3e376b12a8cc58b1e4ecaa9b4aac06", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "pCao", "name": "_"}, {"code": "input_embeddings = token_embeddings + pos_embeddings\nprint(input_embeddings.shape)\n\n# uncomment \u0026 execute the following line to see how the embeddings look like\nprint(input_embeddings)", "code_hash": "d2082033abf89e15b2e099f164adb646", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "wEIy", "name": "_"}], "metadata": {"marimo_version": "0.18.4"}, "version": "1"},
            "session": {"cells": [{"code_hash": "b811c64f15a098eef1dbfb3bc7b139ba", "console": [], "id": "setup", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "221d4670dfdd8c1d81bc579d9cb793d4", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "torch version: 2.9.1+cu128\ntiktoken version: 0.12.0\n", "type": "stream"}], "id": "Hbol", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "8f2b5b49f2d6ba6ef6f6440e9b5764bd", "console": [], "id": "MJUe", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch1 id=\"chapter-2-working-with-text-data\"\u003EChapter 2: Working with Text Data\u003C/h1\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "4c006fff43b47605c97c5eb9aeb5cf7f", "console": [], "id": "vblA", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"22-tokenizing-text\"\u003E2.2 Tokenizing text\u003C/h2\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "c644ef17d9e8447e39d780fd6026347e", "console": [], "id": "bkHC", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EDefine a downloader function for the novel \"The Verdict\" that allows to be used for traning.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "928d1a8cb9d9d9d2ee2f1b208e120435", "console": [], "id": "lEQa", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "5620b08a6e70e5bbc0f1b7ddeab4759a", "console": [], "id": "PKri", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EDownload and read the data.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "4e780d91494428b5256946b840f8f83c", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "Data file already exists at /home/applejxd/src/my-llm/data/the-verdict.txt. Skipping download.\nTotal number of character: 20479\nI HAD always thought Jack Gisburn rather a cheap genius--though a good fellow enough--so it was no \n", "type": "stream"}], "id": "Xref", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "806fd6f1062019a88d02ec3df30c1d04", "console": [], "id": "SFPL", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ESplit words by whitespace using regex.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "47612c8fa936b70b8681c13fc1081c1d", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "['Hello,', ' ', 'world.', ' ', 'This,', ' ', 'is', ' ', 'a', ' ', 'test.']\n", "type": "stream"}], "id": "BYtC", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "6087dc09e326a8b47a7cbca4245f295a", "console": [], "id": "RGSE", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EAdd period (.) and comma (,) separaters for it.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "f1a9c6be173306b038127fc083b0a4f1", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "['Hello', ',', '', ' ', 'world', '.', '', ' ', 'This', ',', '', ' ', 'is', ' ', 'a', ' ', 'test', '.', '']\n", "type": "stream"}], "id": "Kclp", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "52742d4c1829344a2b387c5746e8cfea", "console": [], "id": "emfo", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EDelete whitespaces that is recognized as a separater if it is needed.\nStrip whitespace from each item and then filter out any empty strings.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "067536247bc91ef7e9c14e23ad7ed89b", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "['Hello', ',', 'world', '.', 'This', ',', 'is', 'a', 'test', '.']\n", "type": "stream"}], "id": "Hstk", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "716de2d0f51757b1c87bb8854b0a6196", "console": [], "id": "nWHF", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ETry another example includes symbols like hyphen (-) or question mark (?). These symbols also can be extracted by treating these as separaters.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "e0fa30550d5c9ff49daf5538c21c14ca", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "['Hello', ',', 'world', '.', 'Is', 'this', '--', 'a', 'test', '?']\n", "type": "stream"}], "id": "iLit", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "487fe9447ddf166222e048a3946d991c", "console": [], "id": "ZHCJ", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ESplit The Verdict data whole.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "a399b7d4c7d58e0892b627a86c375214", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "preprocessed[:30]=['I', 'HAD', 'always', 'thought', 'Jack', 'Gisburn', 'rather', 'a', 'cheap', 'genius', '--', 'though', 'a', 'good', 'fellow', 'enough', '--', 'so', 'it', 'was', 'no', 'great', 'surprise', 'to', 'me', 'to', 'hear', 'that', ',', 'in']\nlen(preprocessed)=4690\n", "type": "stream"}], "id": "ROlb", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "c12b1babadec4cfc4cb6caded15b7c7a", "console": [], "id": "qnkX", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"23-converting-tokens-into-token-ids\"\u003E2.3 Converting tokens into token IDs\u003C/h2\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "dfa12e4a5e036c49aa84223eab5bf3b8", "console": [], "id": "TqIu", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ECreate unique list of tokens by using \u003Ccode\u003Eset\u003C/code\u003E, then sort it.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "72b9bfcc42358a509bf131d4c658b3da", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "1130\n", "type": "stream"}], "id": "Vxnm", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "98ab0407f8df03fb179d8262c51d0331", "console": [], "id": "DnEU", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ECreate map (dictionary) from token to token ID, then show it.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "ea257066237ca121a72d9b750af6a44d", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "('!', 0)\n('\"', 1)\n(\"'\", 2)\n('(', 3)\n(')', 4)\n(',', 5)\n('--', 6)\n('.', 7)\n(':', 8)\n(';', 9)\n('?', 10)\n('A', 11)\n('Ah', 12)\n('Among', 13)\n('And', 14)\n('Are', 15)\n('Arrt', 16)\n('As', 17)\n('At', 18)\n('Be', 19)\n('Begin', 20)\n('Burlington', 21)\n('But', 22)\n('By', 23)\n('Carlo', 24)\n('Chicago', 25)\n('Claude', 26)\n('Come', 27)\n('Croft', 28)\n('Destroyed', 29)\n('Devonshire', 30)\n('Don', 31)\n('Dubarry', 32)\n('Emperors', 33)\n('Florence', 34)\n('For', 35)\n('Gallery', 36)\n('Gideon', 37)\n('Gisburn', 38)\n('Gisburns', 39)\n('Grafton', 40)\n('Greek', 41)\n('Grindle', 42)\n('Grindles', 43)\n('HAD', 44)\n('Had', 45)\n('Hang', 46)\n('Has', 47)\n('He', 48)\n('Her', 49)\n('Hermia', 50)\n", "type": "stream"}], "id": "ulZA", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "ac58c91420f4c297a9699e9b30890f2f", "console": [], "id": "ecfG", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EDefine a simple tokenizer based on these, and implement not only encoder but also decoder by defining the inverse mapping.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "b6c481725481c9c62c36d424640bd94b", "console": [], "id": "Pvdt", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "d2cc787969cb815f91dc8b5b83f601d8", "console": [], "id": "ZBYS", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EApply the encoder process to a sentence from The Verdict.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "bdf315624ec093cd400248fd3000eb14", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "[1, 56, 2, 850, 988, 602, 533, 746, 5, 1126, 596, 5, 1, 67, 7, 38, 851, 1108, 754, 793, 7]\n", "type": "stream"}], "id": "aLJB", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "b06d5372a3efc06d33f4dbf0e9895f9b", "console": [], "id": "nHfw", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ETry decoding it to check whether it is invertive.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "aa5a76875e01c75affc6a3940b396d8f", "console": [], "id": "xXTn", "outputs": [{"data": {"text/html": "\u003Cpre class='text-xs'\u003E\u0026#x27;\u0026quot; It\\\u0026#x27; s the last he painted, you know,\u0026quot; Mrs. Gisburn said with pardonable pride.\u0026#x27;\u003C/pre\u003E"}, "type": "data"}]}, {"code_hash": "e4e290f6df1bc3999ef7bb2f4e7a15d2", "console": [], "id": "AjVT", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ECombine these.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "ab86fa92838ab6fe8da4bae62c794147", "console": [], "id": "pHFh", "outputs": [{"data": {"text/html": "\u003Cpre class='text-xs'\u003E\u0026#x27;\u0026quot; It\\\u0026#x27; s the last he painted, you know,\u0026quot; Mrs. Gisburn said with pardonable pride.\u0026#x27;\u003C/pre\u003E"}, "type": "data"}]}, {"code_hash": "26eefac673a38afebd45a4d95a6f62e9", "console": [], "id": "NCOB", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EWe cannot treat unknown words that are not included in the vocabulary. This will occur an error.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "4e7dee53fe9ca3ef1e339a895531715c", "console": [{"mimetype": "application/vnd.marimo+traceback", "name": "stderr", "text": "\u003Cspan class=\"codehilite\"\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Cspan\u003E\u003C/span\u003E\u003Cspan class=\"gt\"\u003ETraceback (most recent call last):\u003C/span\u003E\n  File \u003Cspan class=\"nb\"\u003E\u0026quot;/tmp/marimo_21375/__marimo__cell_aqbW_.py\u0026quot;\u003C/span\u003E, line \u003Cspan class=\"m\"\u003E3\u003C/span\u003E, in \u003Cspan class=\"n\"\u003E\u0026lt;module\u0026gt;\u003C/span\u003E\n\u003Cspan class=\"w\"\u003E    \u003C/span\u003E\u003Cspan class=\"n\"\u003Esimple_tokenizer\u003C/span\u003E\u003Cspan class=\"o\"\u003E.\u003C/span\u003E\u003Cspan class=\"n\"\u003Eencode\u003C/span\u003E\u003Cspan class=\"p\"\u003E(\u003C/span\u003E\u003Cspan class=\"n\"\u003Etext_4\u003C/span\u003E\u003Cspan class=\"p\"\u003E)\u003C/span\u003E\n  File \u003Cspan class=\"nb\"\u003E\u0026quot;/tmp/marimo_21375/__marimo__cell_Pvdt_.py\u0026quot;\u003C/span\u003E, line \u003Cspan class=\"m\"\u003E13\u003C/span\u003E, in \u003Cspan class=\"n\"\u003Eencode\u003C/span\u003E\n\u003Cspan class=\"w\"\u003E    \u003C/span\u003E\u003Cspan class=\"n\"\u003Eids\u003C/span\u003E \u003Cspan class=\"o\"\u003E=\u003C/span\u003E \u003Cspan class=\"p\"\u003E[\u003C/span\u003E\u003Cspan class=\"bp\"\u003Eself\u003C/span\u003E\u003Cspan class=\"o\"\u003E.\u003C/span\u003E\u003Cspan class=\"n\"\u003Estr_to_int\u003C/span\u003E\u003Cspan class=\"p\"\u003E[\u003C/span\u003E\u003Cspan class=\"n\"\u003Es\u003C/span\u003E\u003Cspan class=\"p\"\u003E]\u003C/span\u003E \u003Cspan class=\"k\"\u003Efor\u003C/span\u003E \u003Cspan class=\"n\"\u003Es\u003C/span\u003E \u003Cspan class=\"ow\"\u003Ein\u003C/span\u003E \u003Cspan class=\"n\"\u003Epreprocessed\u003C/span\u003E\u003Cspan class=\"p\"\u003E]\u003C/span\u003E\n\u003Cspan class=\"w\"\u003E           \u003C/span\u003E\u003Cspan class=\"pm\"\u003E~~~~~~~~~~~~~~~^^^\u003C/span\u003E\n\u003Cspan class=\"gr\"\u003EKeyError\u003C/span\u003E: \u003Cspan class=\"n\"\u003E\u0026#39;Hello\u0026#39;\u003C/span\u003E\n\u003C/pre\u003E\u003C/div\u003E\n\u003C/span\u003E", "type": "stream"}], "id": "aqbW", "outputs": [{"ename": "exception", "evalue": "'Hello'", "traceback": [], "type": "error"}]}, {"code_hash": "9dba180ab344b62c64055cbd382cf9be", "console": [], "id": "TRpd", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"24-adding-special-context-tokens\"\u003E2.4 Adding special context tokens\u003C/h2\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "a1551d8335269138eb3cbaad2daa0882", "console": [], "id": "TXez", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ETo fix the vocabulary issues, the special token for unknown words should be added as \u003Ccode\u003Eunk\u003C/code\u003E. The special token to combine multiple texts is also added as \u003Ccode\u003Eendoftext\u003C/code\u003E.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "a1a299db1ab79b7c544c7171c753e4d4", "console": [], "id": "dNNg", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "850ddf4b9b5910bdb3932aa84b1f4f5d", "console": [], "id": "yCnT", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThe total number of the vocabulary is increased \u003Cmarimo-tex class=\"arithmatex\"\u003E||(1130+2=1132||)\u003C/marimo-tex\u003E.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "c77ec58a385eb394bec234a911c8a7c6", "console": [], "id": "wlCL", "outputs": [{"data": {"text/html": "\u003Cpre class='text-xs'\u003E1132\u003C/pre\u003E"}, "type": "data"}]}, {"code_hash": "bf19cd2d5800b550dd21e1aaf8614fc6", "console": [], "id": "kqZH", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ECheck the tail.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "d9c605999dcc12c20dede81d29e2ab0d", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "('younger', 1127)\n('your', 1128)\n('yourself', 1129)\n('\u003C|endoftext|\u003E', 1130)\n('\u003C|unk|\u003E', 1131)\n", "type": "stream"}], "id": "wAgl", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "70e5007f7947dd399df56d7d108792a5", "console": [], "id": "rEll", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThis is updated simple tokenier includes the special tokens.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "d8377cc00a65cbaa17ac6194965ed39e", "console": [], "id": "dGlV", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "057cb48bd2dafeba41b8a3d6d7d27cbd", "console": [], "id": "SdmI", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ETry to tokenize concatenated texts by the special token.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "b2b3daa5c3a7e59bdbee5696b2a8781f", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "Hello, do you like tea? \u003C|endoftext|\u003E In the sunlit terraces of the palace.\n", "type": "stream"}], "id": "lgWD", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "f3da786513b585d412483170ba342418", "console": [], "id": "yOPj", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThen, tokenize it. You will see token ID 1130 and 1131 that are asigned for the special tokens.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "325e071f7f4a3db4562cc7c7b7179d06", "console": [], "id": "fwwy", "outputs": [{"data": {"application/json": "[1131, 5, 355, 1126, 628, 975, 10, 1130, 55, 988, 956, 984, 722, 988, 1131, 7]"}, "type": "data"}]}, {"code_hash": "a20ed35700cfa3615b25ff7f9e835a15", "console": [], "id": "LJZf", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EDecode it to check the tokenization.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "c17f4939b738cda59f2c115230c4d7ca", "console": [], "id": "urSm", "outputs": [{"data": {"text/html": "\u003Cpre class='text-xs'\u003E\u0026#x27;\u0026lt;|unk|\u0026gt;, do you like tea? \u0026lt;|endoftext|\u0026gt; In the sunlit terraces of the \u0026lt;|unk|\u0026gt;.\u0026#x27;\u003C/pre\u003E"}, "type": "data"}]}, {"code_hash": "0c8908e51e6bf4a43f0fa882e89b591e", "console": [], "id": "jxvo", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"25-bytepair-encoding\"\u003E2.5 BytePair encoding\u003C/h2\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "f67d26b4f68f67e6e41a9e68266fcd09", "console": [], "id": "mWxS", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ETo avoid unknown tokens, introduce byte pair encoding (BPE) by using tiktoken.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "b7bdb952c4a41936bd41ee846d179a13", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "tiktoken version: 0.12.0\n", "type": "stream"}], "id": "CcZR", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "c06a1e36ae8f46076ba89450818608e2", "console": [], "id": "YWSi", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ETry the tiktoken tokenizer for GPT2 model. The max token ID 50256 is assigned for \u003Ccode\u003Eendoftext\u003C/code\u003E.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "e3a7b99ae792d7f7e06727d557219865", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "[15496, 11, 466, 345, 588, 8887, 30, 220, 50256, 554, 262, 4252, 18250, 8812, 2114, 1659, 617, 34680, 27271, 13]\n", "type": "stream"}], "id": "zlud", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "c726e525f8da8242ec1515e02e374990", "console": [], "id": "tZnO", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ECheck it by using the decoding. It encodes all tokens in unique manner by using subworkds and the combined words. So, this is invertive.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "4df1be27003ced3b6a27eaf5f8166ead", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "Hello, do you like tea? \u003C|endoftext|\u003E In the sunlit terracesof someunknownPlace.\n", "type": "stream"}], "id": "xvXZ", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "5fc2e49699efb7ee03102d9a3c28852b", "console": [], "id": "CLip", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ETo know BPE, see \u003Ca href=\"../../third_party/LLMs-from-scratch/ch02/05_bpe-from-scratch/bpe-from-scratch.ipynb\"\u003Ethis\u003C/a\u003E.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "775ab3be1c72d33526fde08796f670bc", "console": [], "id": "YECM", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"26-data-sampling-with-a-sliding-window\"\u003E2.6 Data sampling with a sliding window\u003C/h2\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "60e9ed1e714cb207b59f1739d2bdcc04", "console": [], "id": "cEAS", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EUse BPE tokenizer for tokenization of The Verdict, and show the size of the all tokens.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "d0ef41fca87026a2d5b7bb9d1bee2e0e", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "5145\n", "type": "stream"}], "id": "iXej", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "5177dadab4e683865f8980ae630b3501", "console": [], "id": "EJmg", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EDelete the beginning for a later demonstration.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "1f178580c3a29740e9ec4700212be1a1", "console": [], "id": "UmEG", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "d25559a446eba525765e4f1c4c064dd9", "console": [], "id": "vEBW", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ECreate learning pairs to predict next tokens. The task is predicting the \u003Ccode\u003Ey\u003C/code\u003E from the \u003Ccode\u003Ex\u003C/code\u003E.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "ba3fd82064d4e55004a9f80c03434a68", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "x: [290, 4920, 2241, 287]\ny:      [4920, 2241, 287, 257]\n", "type": "stream"}], "id": "kLmu", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "d52d451224ff4dc14301f658aaa378cd", "console": [], "id": "IpqN", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThe mappings will be learned are these.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "4b3e026a88a7fa0948db74a664633fb2", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "[290] ----\u003E 4920\n[290, 4920] ----\u003E 2241\n[290, 4920, 2241] ----\u003E 287\n[290, 4920, 2241, 287] ----\u003E 257\n", "type": "stream"}], "id": "dxZZ", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "9e621993327192529a10698ae99b8e50", "console": [], "id": "dlnW", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EDecode these token IDs to check the words.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "a5bbe1774beeafc2d499900a76336917", "console": [{"mimetype": "text/plain", "name": "stdout", "text": " and ----\u003E  established\n and established ----\u003E  himself\n and established himself ----\u003E  in\n and established himself in ----\u003E  a\n", "type": "stream"}], "id": "TTti", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "a4316a2d5e96f771db61f331d5ec48db", "console": [], "id": "RKFZ", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ELet's define dataset for this by using PyTorch.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "3cae89922448b73c1072ed81b9a6a159", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "PyTorch version: 2.9.1+cu128\n", "type": "stream"}], "id": "IaQp", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "f4f284f9e09e71fb17873d892d72e554", "console": [], "id": "IWgg", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ETo define PyTorch dataset, we need to define special methods \u003Ccode\u003E__len__\u003C/code\u003E and \u003Ccode\u003E__getitem__\u003C/code\u003E for iterater use. We implement the indexing for tokenized tensor with chunks whose size is \u003Ccode\u003Emax_length\u003C/code\u003E with \u003Ccode\u003Estride\u003C/code\u003E step size (sliding window).\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "4861ccc76f2436d0377c5af8ccc8123e", "console": [], "id": "fCoF", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "21ab3e77bc69c7817060919892963014", "console": [], "id": "LkGn", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EDefine a function to instantiate the dataloader class.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "6fde38f6d1dcba250555540824213762", "console": [], "id": "zVRe", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "3343621115915a0732649c769b899088", "console": [], "id": "woaO", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EFor debugging, define a decoder function for batches.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "14c172be19288dd96099c0b293a4633f", "console": [], "id": "HnMC", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "ab6d86392b648d2ff793122f11b9388c", "console": [], "id": "wadT", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ECall the function to check the data batches. The output should be the pair of input IDs and target IDs.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "c3e1ce732bd0f23191a1988bf6c1c145", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "_first_batch=[tensor([[  40,  367, 2885, 1464]]), tensor([[ 367, 2885, 1464, 1807]])]\n_inputs_decoded=['I HAD always']\n_targets_decoded=[' HAD always thought']\n", "type": "stream"}], "id": "VCRE", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "370791cffe1de6dd33c2911655fbbda3", "console": [], "id": "hgqU", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EIterate again and check the next batch. You will see only 1 shifted tokens from the previous because of \u003Ccode\u003Estride=1\u003C/code\u003E.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "f2fdf5f12cc05bfb4b74dedb225a773d", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "_second_batch=[tensor([[ 367, 2885, 1464, 1807]]), tensor([[2885, 1464, 1807, 3619]])]\n_inputs_decoded=[' HAD always thought']\n_targets_decoded=['AD always thought Jack']\n", "type": "stream"}], "id": "PSUk", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "1745f425f9315e279e4683dd7c08abe7", "console": [], "id": "mfOT", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ETry larger batch size (\u003Ccode\u003Ebatch_size=8\u003C/code\u003E) for robust training. To avoid overfitting, the stride is also increased (\u003Ccode\u003Estride=4\u003C/code\u003E).\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "dd06a95c566fc2b679e22ede0e0148f1", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "Inputs:\n tensor([[   40,   367,  2885,  1464],\n        [ 1807,  3619,   402,   271],\n        [10899,  2138,   257,  7026],\n        [15632,   438,  2016,   257],\n        [  922,  5891,  1576,   438],\n        [  568,   340,   373,   645],\n        [ 1049,  5975,   284,   502],\n        [  284,  3285,   326,    11]])\n\nTargets:\n tensor([[  367,  2885,  1464,  1807],\n        [ 3619,   402,   271, 10899],\n        [ 2138,   257,  7026, 15632],\n        [  438,  2016,   257,   922],\n        [ 5891,  1576,   438,   568],\n        [  340,   373,   645,  1049],\n        [ 5975,   284,   502,   284],\n        [ 3285,   326,    11,   287]])\n_inputs_decoded=['I HAD always', ' thought Jack Gis', 'burn rather a cheap', ' genius--though a', ' good fellow enough--', 'so it was no', ' great surprise to me', ' to hear that,']\n_targets_decoded=[' HAD always thought', ' Jack Gisburn', ' rather a cheap genius', '--though a good', ' fellow enough--so', ' it was no great', ' surprise to me to', ' hear that, in']\n", "type": "stream"}], "id": "vGiW", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "69048aa7b2ee3cbf3a0923693c8ccc26", "console": [], "id": "SYQT", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"27-creating-token-embeddings\"\u003E2.7 Creating token embeddings\u003C/h2\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "a3d2ff412cc003d3c7efb6aeff126b8b", "console": [], "id": "bMrW", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThis is an example for token embeddings that accepts 6-dimensional input as the vocabulary and outputs 3-dimensional embedding vector.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThe embedding is represented by a matrix whose rows represents embedding vectors for each vocabularies.\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003EThe representation matrix can be trained.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "51f6d7df63d7788c8859ebcf5af92577", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "Parameter containing:\ntensor([[ 0.3374, -0.1778, -0.1690],\n        [ 0.9178,  1.5810,  1.3010],\n        [ 1.2753, -0.2010, -0.1606],\n        [-0.4015,  0.9666, -1.1481],\n        [-1.1589,  0.3255, -0.6315],\n        [-2.8400, -0.7849, -1.4096]], requires_grad=True)\n", "type": "stream"}], "id": "PSQn", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "0c7f2db4f5f138b40620b47b1cdd4d11", "console": [], "id": "OfTS", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ELet's try the embedding for token ID 3.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "3ca5b94ed7bb620774c44e1d1995ad25", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "tensor([[-0.4015,  0.9666, -1.1481]], grad_fn=\u003CEmbeddingBackward0\u003E)\n", "type": "stream"}], "id": "lQxp", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "a38fe0c5cd694295181e821dd51d3bcf", "console": [], "id": "Plbk", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ETry more embeddings. This is just referring the matrix as LUT (Look Up Table).\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "1bf8ddd1a3f8211e8c213bdbd95eadbd", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "tensor([[ 1.2753, -0.2010, -0.1606],\n        [-0.4015,  0.9666, -1.1481],\n        [-2.8400, -0.7849, -1.4096],\n        [ 0.9178,  1.5810,  1.3010]], grad_fn=\u003CEmbeddingBackward0\u003E)\n", "type": "stream"}], "id": "rSYo", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "a0703e403e44433a1900882327eb5d3b", "console": [], "id": "HuZB", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"28-encoding-word-positions\"\u003E2.8 Encoding word positions\u003C/h2\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "e6624cd2e66b4341ce8582a70c7f3bc9", "console": [], "id": "WfYj", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003ETry positional encoding based on this configurations.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "d567f9f631b45e9a8353cba9b37dd6db", "console": [], "id": "Ynfw", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "4dfedc2b3949c63bb88dc663380dffab", "console": [], "id": "LqFA", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "a9f85c6b75e3ea544b0a1b1bec16a9d4", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "Token IDs:\n tensor([[   40,   367,  2885,  1464],\n        [ 1807,  3619,   402,   271],\n        [10899,  2138,   257,  7026],\n        [15632,   438,  2016,   257],\n        [  922,  5891,  1576,   438],\n        [  568,   340,   373,   645],\n        [ 1049,  5975,   284,   502],\n        [  284,  3285,   326,    11]])\n\nInputs shape:\n torch.Size([8, 4])\n", "type": "stream"}], "id": "uDnK", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "76a828279ee6bc746434b4bc9495bdc3", "console": [], "id": "aWBL", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThen, these tokens are embedded to 256-dimensional manifold.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "0e54cef5de9f1e7096ffc04d6080b690", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "torch.Size([8, 4, 256])\n", "type": "stream"}], "id": "MIsd", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "7a032648fa11b7dd07387ae18dfe407c", "console": [], "id": "IrqS", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EAbsolute positional embedding is also proceeded by using another \u003Ccode\u003Etorch.nn.Embedding\u003C/code\u003E layer.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "8180682017cd1bde28df2447a02df190", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "Parameter containing:\ntensor([[ 1.7375, -0.5620, -0.6303,  ..., -0.2277,  1.5748,  1.0345],\n        [ 1.6423, -0.7201,  0.2062,  ...,  0.4118,  0.1498, -0.4628],\n        [-0.4651, -0.7757,  0.5806,  ...,  1.4335, -0.4963,  0.8579],\n        [-0.6754, -0.4628,  1.4323,  ...,  0.8139, -0.7088,  0.4827]],\n       requires_grad=True)\n", "type": "stream"}], "id": "Lpqv", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "ab99ab5e92dbd69053c464ae2e287d07", "console": [], "id": "upgv", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThen, indexes represents absolute positions are input to it. This can be also interpreted as LUT.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "27abc817f810bcab5786e3a08cc0330e", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "torch.Size([4, 256])\ntensor([[ 1.7375, -0.5620, -0.6303,  ..., -0.2277,  1.5748,  1.0345],\n        [ 1.6423, -0.7201,  0.2062,  ...,  0.4118,  0.1498, -0.4628],\n        [-0.4651, -0.7757,  0.5806,  ...,  1.4335, -0.4963,  0.8579],\n        [-0.6754, -0.4628,  1.4323,  ...,  0.8139, -0.7088,  0.4827]],\n       grad_fn=\u003CEmbeddingBackward0\u003E)\n", "type": "stream"}], "id": "WJUG", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "5a3e376b12a8cc58b1e4ecaa9b4aac06", "console": [], "id": "pCao", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Cspan class=\"paragraph\"\u003EThe absolute positional encoding is just adding these.\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "d2082033abf89e15b2e099f164adb646", "console": [{"mimetype": "text/plain", "name": "stdout", "text": "torch.Size([8, 4, 256])\ntensor([[[ 2.2288,  0.5619,  0.8286,  ..., -0.6272, -0.2987,  0.8900],\n         [ 2.0903, -0.4664, -0.0593,  ...,  0.9115, -1.0493, -1.6473],\n         [-0.7158, -0.8304,  1.2494,  ...,  2.3952,  1.8773,  0.8051],\n         [ 0.2703,  0.4029,  3.0514,  ...,  0.3595, -1.4548,  0.8310]],\n\n        [[ 3.2835,  1.1749, -1.4150,  ..., -0.3281,  2.4332,  0.6924],\n         [-0.2199, -0.9114, -0.1750,  ...,  1.5337, -0.1998,  0.1462],\n         [ 1.5197, -1.4240,  0.4391,  ...,  1.0494, -1.4318,  2.3057],\n         [ 0.2893,  0.8346, -0.1884,  ...,  1.9602,  0.8709,  0.8796]],\n\n        [[ 0.9662,  0.0952, -0.4640,  ..., -1.0320,  1.6290,  1.7771],\n         [ 2.4468, -0.2154,  1.4984,  ...,  1.8766,  0.5595, -0.1423],\n         [-0.3856, -2.5393,  1.1556,  ...,  3.6157,  1.3267,  0.4944],\n         [-0.2487, -0.5275,  2.0009,  ...,  0.2930,  0.5977,  1.3300]],\n\n        ...,\n\n        [[ 0.1219,  0.3991, -3.2740,  ..., -1.1921,  2.6637,  2.6728],\n         [ 1.2438, -1.6436, -1.1101,  ..., -0.7464, -0.9816,  0.5118],\n         [ 0.1439, -0.2428,  0.7786,  ...,  0.8001, -1.5986,  2.4871],\n         [-0.3077, -0.6329,  0.0536,  ...,  1.5188, -0.2060,  0.4254]],\n\n        [[ 1.6095,  0.0535,  1.0871,  ...,  0.1512,  1.0996,  2.5603],\n         [ 2.1284, -2.4306,  0.6478,  ...,  0.5593, -1.6896,  1.4126],\n         [-1.4224, -0.0750,  1.9386,  ...,  3.3712, -2.4016, -0.3237],\n         [-0.4752, -1.2234, -0.0847,  ...,  0.7834, -1.0744,  0.3429]],\n\n        [[ 0.7802,  0.1387,  0.7277,  ...,  1.7101, -0.3304, -0.1471],\n         [ 1.5791, -1.3749, -0.8234,  ..., -0.5420, -0.3528, -0.5756],\n         [ 0.1382,  0.1226,  2.6528,  ...,  2.9576, -0.2933,  0.5577],\n         [ 0.4520, -0.5711,  1.2128,  ...,  1.3198, -2.5226,  0.4127]]],\n       grad_fn=\u003CAddBackward0\u003E)\n", "type": "stream"}], "id": "wEIy", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}], "metadata": {"marimo_version": "0.18.4"}, "version": "1"},
            "runtimeConfig": null,
        };
    </script>
  
<marimo-code hidden="">
    import%20marimo%0A%0A__generated_with%20%3D%20%220.18.4%22%0Aapp%20%3D%20marimo.App(width%3D%22medium%22)%0A%0Awith%20app.setup%3A%0A%20%20%20%20import%20importlib%0A%20%20%20%20import%20re%0A%20%20%20%20from%20importlib.metadata%20import%20version%0A%20%20%20%20from%20pathlib%20import%20Path%0A%0A%20%20%20%20import%20marimo%20as%20mo%0A%20%20%20%20import%20requests%0A%20%20%20%20import%20tiktoken%0A%20%20%20%20import%20torch%0A%20%20%20%20from%20torch.utils.data%20import%20DataLoader%2C%20Dataset%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20print(%22torch%20version%3A%22%2C%20version(%22torch%22))%0A%20%20%20%20print(%22tiktoken%20version%3A%22%2C%20version(%22tiktoken%22))%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%20Chapter%202%3A%20Working%20with%20Text%20Data%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%202.2%20Tokenizing%20text%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Define%20a%20downloader%20function%20for%20the%20novel%20%22The%20Verdict%22%20that%20allows%20to%20be%20used%20for%20traning.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.function%0Adef%20download_verdict_data()%3A%0A%20%20%20%20project_root%20%3D%20Path(__file__).parent.parent.parent%0A%20%20%20%20data_root%20%3D%20project_root%20%2F%20%22data%22%0A%20%20%20%20data_root.mkdir(parents%3DTrue%2C%20exist_ok%3DTrue)%0A%0A%20%20%20%20file_path%20%3D%20data_root%20%2F%20%22the-verdict.txt%22%0A%20%20%20%20if%20file_path.exists()%3A%0A%20%20%20%20%20%20%20%20print(f%22Data%20file%20already%20exists%20at%20%7Bfile_path%7D.%20Skipping%20download.%22)%0A%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20data_url%20%3D%20%22https%3A%2F%2Fraw.githubusercontent.com%2Frasbt%2FLLMs-from-scratch%2Fmain%2Fch02%2F01_main-chapter-code%2Fthe-verdict.txt%22%0A%20%20%20%20%20%20%20%20response%20%3D%20requests.get(data_url%2C%20timeout%3D30)%0A%20%20%20%20%20%20%20%20response.raise_for_status()%0A%20%20%20%20%20%20%20%20text_data%20%3D%20response.text%0A%20%20%20%20%20%20%20%20with%20open(file_path%2C%20%22w%22%2C%20encoding%3D%22utf-8%22)%20as%20file%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20file.write(text_data)%0A%20%20%20%20return%20file_path%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Download%20and%20read%20the%20data.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20verdict_file_path%20%3D%20download_verdict_data()%0A%20%20%20%20with%20open(verdict_file_path%2C%20%22r%22%2C%20encoding%3D%22utf-8%22)%20as%20f%3A%0A%20%20%20%20%20%20%20%20raw_text%20%3D%20f.read()%0A%0A%20%20%20%20print(%22Total%20number%20of%20character%3A%22%2C%20len(raw_text))%0A%20%20%20%20print(raw_text%5B%3A99%5D)%0A%20%20%20%20return%20(raw_text%2C)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Split%20words%20by%20whitespace%20using%20regex.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20text_1%20%3D%20%22Hello%2C%20world.%20This%2C%20is%20a%20test.%22%0A%20%20%20%20_result%20%3D%20re.split(r%22(%5Cs)%22%2C%20text_1)%0A%20%20%20%20print(_result)%0A%20%20%20%20return%20(text_1%2C)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Add%20period%20(.)%20and%20comma%20(%2C)%20separaters%20for%20it.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(text_1)%3A%0A%20%20%20%20result_1%20%3D%20re.split(r%22(%5B%2C.%5D%7C%5Cs)%22%2C%20text_1)%0A%20%20%20%20print(result_1)%0A%20%20%20%20return%20(result_1%2C)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Delete%20whitespaces%20that%20is%20recognized%20as%20a%20separater%20if%20it%20is%20needed.%0A%20%20%20%20Strip%20whitespace%20from%20each%20item%20and%20then%20filter%20out%20any%20empty%20strings.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(result_1)%3A%0A%20%20%20%20_result%20%3D%20%5Bitem%20for%20item%20in%20result_1%20if%20item.strip()%5D%0A%20%20%20%20print(_result)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Try%20another%20example%20includes%20symbols%20like%20hyphen%20(-)%20or%20question%20mark%20(%3F).%20These%20symbols%20also%20can%20be%20extracted%20by%20treating%20these%20as%20separaters.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20text_2%20%3D%20%22Hello%2C%20world.%20Is%20this--%20a%20test%3F%22%0A%0A%20%20%20%20_result%20%3D%20re.split(r'(%5B%2C.%3A%3B%3F_!%22()%5C'%5D%7C--%7C%5Cs)'%2C%20text_2)%0A%20%20%20%20_result%20%3D%20%5Bitem.strip()%20for%20item%20in%20_result%20if%20item.strip()%5D%0A%20%20%20%20print(_result)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Split%20The%20Verdict%20data%20whole.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(raw_text)%3A%0A%20%20%20%20preprocessed%20%3D%20re.split(r'(%5B%2C.%3A%3B%3F_!%22()%5C'%5D%7C--%7C%5Cs)'%2C%20raw_text)%0A%20%20%20%20preprocessed%20%3D%20%5Bitem.strip()%20for%20item%20in%20preprocessed%20if%20item.strip()%5D%0A%20%20%20%20print(f%22%7Bpreprocessed%5B%3A30%5D%3D%7D%22)%0A%20%20%20%20print(f%22%7Blen(preprocessed)%3D%7D%22)%0A%20%20%20%20return%20(preprocessed%2C)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%202.3%20Converting%20tokens%20into%20token%20IDs%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Create%20unique%20list%20of%20tokens%20by%20using%20%60set%60%2C%20then%20sort%20it.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(preprocessed)%3A%0A%20%20%20%20all_words%20%3D%20sorted(set(preprocessed))%0A%20%20%20%20_vocab_size%20%3D%20len(all_words)%0A%20%20%20%20print(_vocab_size)%0A%20%20%20%20return%20(all_words%2C)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Create%20map%20(dictionary)%20from%20token%20to%20token%20ID%2C%20then%20show%20it.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(all_words)%3A%0A%20%20%20%20vocab%20%3D%20%7Btoken%3A%20integer%20for%20integer%2C%20token%20in%20enumerate(all_words)%7D%0A%20%20%20%20for%20_i%2C%20_item%20in%20enumerate(vocab.items())%3A%0A%20%20%20%20%20%20%20%20print(_item)%0A%20%20%20%20%20%20%20%20if%20_i%20%3E%3D%2050%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20break%0A%20%20%20%20return%20(vocab%2C)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Define%20a%20simple%20tokenizer%20based%20on%20these%2C%20and%20implement%20not%20only%20encoder%20but%20also%20decoder%20by%20defining%20the%20inverse%20mapping.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.class_definition%0Aclass%20SimpleTokenizerV1%3A%0A%20%20%20%20def%20__init__(self%2C%20vocab)%3A%0A%20%20%20%20%20%20%20%20self.str_to_int%20%3D%20vocab%0A%20%20%20%20%20%20%20%20%23%20inverse%20mapping%0A%20%20%20%20%20%20%20%20self.int_to_str%20%3D%20%7Bi%3A%20s%20for%20s%2C%20i%20in%20vocab.items()%7D%0A%0A%20%20%20%20def%20encode(self%2C%20text)%3A%0A%20%20%20%20%20%20%20%20%23%20Split%20by%20specified%20punctuations%20and%20whitespace%0A%20%20%20%20%20%20%20%20preprocessed%20%3D%20re.split(r'(%5B%2C.%3A%3B%3F_!%22()%5C'%5D%7C--%7C%5Cs)'%2C%20text)%0A%20%20%20%20%20%20%20%20%23%20Remove%20empty%20strings%20and%20whitespace-only%20strings%0A%20%20%20%20%20%20%20%20preprocessed%20%3D%20%5Bitem.strip()%20for%20item%20in%20preprocessed%20if%20item.strip()%5D%0A%20%20%20%20%20%20%20%20%23%20Map%20to%20token%20IDs%0A%20%20%20%20%20%20%20%20ids%20%3D%20%5Bself.str_to_int%5Bs%5D%20for%20s%20in%20preprocessed%5D%0A%20%20%20%20%20%20%20%20return%20ids%0A%0A%20%20%20%20def%20decode(self%2C%20ids)%3A%0A%20%20%20%20%20%20%20%20%23%20Map%20token%20IDs%20back%20to%20strings%20by%20joining%20with%20spaces%0A%20%20%20%20%20%20%20%20text%20%3D%20%22%20%22.join(%5Bself.int_to_str%5Bi%5D%20for%20i%20in%20ids%5D)%0A%20%20%20%20%20%20%20%20%23%20Replace%20spaces%20before%20the%20specified%20punctuations%0A%20%20%20%20%20%20%20%20text%20%3D%20re.sub(r'%5Cs%2B(%5B%2C.%3F!%22()%5C'%5D)'%2C%20r%22%5C1%22%2C%20text)%0A%20%20%20%20%20%20%20%20return%20text%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Apply%20the%20encoder%20process%20to%20a%20sentence%20from%20The%20Verdict.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(vocab)%3A%0A%20%20%20%20simple_tokenizer%20%3D%20SimpleTokenizerV1(vocab)%0A%0A%20%20%20%20text_3%20%3D%20%22%22%22%22It's%20the%20last%20he%20painted%2C%20you%20know%2C%22%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Mrs.%20Gisburn%20said%20with%20pardonable%20pride.%22%22%22%0A%20%20%20%20token_ids_3%20%3D%20simple_tokenizer.encode(text_3)%0A%20%20%20%20print(token_ids_3)%0A%20%20%20%20return%20simple_tokenizer%2C%20text_3%2C%20token_ids_3%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Try%20decoding%20it%20to%20check%20whether%20it%20is%20invertive.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(simple_tokenizer%2C%20token_ids_3)%3A%0A%20%20%20%20simple_tokenizer.decode(token_ids_3)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Combine%20these.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(simple_tokenizer%2C%20text_3)%3A%0A%20%20%20%20simple_tokenizer.decode(simple_tokenizer.encode(text_3))%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20We%20cannot%20treat%20unknown%20words%20that%20are%20not%20included%20in%20the%20vocabulary.%20This%20will%20occur%20an%20error.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(simple_tokenizer)%3A%0A%20%20%20%20text_4%20%3D%20%22Hello%2C%20do%20you%20like%20tea.%20Is%20this--%20a%20test%3F%22%0A%0A%20%20%20%20simple_tokenizer.encode(text_4)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%202.4%20Adding%20special%20context%20tokens%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20To%20fix%20the%20vocabulary%20issues%2C%20the%20special%20token%20for%20unknown%20words%20should%20be%20added%20as%20%60unk%60.%20The%20special%20token%20to%20combine%20multiple%20texts%20is%20also%20added%20as%20%60endoftext%60.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(preprocessed)%3A%0A%20%20%20%20all_tokens%20%3D%20sorted(list(set(preprocessed)))%0A%20%20%20%20all_tokens.extend(%5B%22%3C%7Cendoftext%7C%3E%22%2C%20%22%3C%7Cunk%7C%3E%22%5D)%0A%0A%20%20%20%20vocab_extended%20%3D%20%7Btoken%3A%20integer%20for%20integer%2C%20token%20in%20enumerate(all_tokens)%7D%0A%20%20%20%20return%20(vocab_extended%2C)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20The%20total%20number%20of%20the%20vocabulary%20is%20increased%20%241130%2B2%3D1132%24.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(vocab_extended)%3A%0A%20%20%20%20len(vocab_extended.items())%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Check%20the%20tail.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(vocab_extended)%3A%0A%20%20%20%20for%20_i%2C%20_item%20in%20enumerate(list(vocab_extended.items())%5B-5%3A%5D)%3A%0A%20%20%20%20%20%20%20%20print(_item)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20This%20is%20updated%20simple%20tokenier%20includes%20the%20special%20tokens.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.class_definition%0Aclass%20SimpleTokenizerV2%3A%0A%20%20%20%20def%20__init__(self%2C%20vocab)%3A%0A%20%20%20%20%20%20%20%20self.str_to_int%20%3D%20vocab%0A%20%20%20%20%20%20%20%20self.int_to_str%20%3D%20%7Bi%3A%20s%20for%20s%2C%20i%20in%20vocab.items()%7D%0A%0A%20%20%20%20def%20encode(self%2C%20text)%3A%0A%20%20%20%20%20%20%20%20preprocessed%20%3D%20re.split(r'(%5B%2C.%3A%3B%3F_!%22()%5C'%5D%7C--%7C%5Cs)'%2C%20text)%0A%20%20%20%20%20%20%20%20preprocessed%20%3D%20%5Bitem.strip()%20for%20item%20in%20preprocessed%20if%20item.strip()%5D%0A%20%20%20%20%20%20%20%20%23%20Handle%20unknown%20tokens%0A%20%20%20%20%20%20%20%20preprocessed%20%3D%20%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20item%20if%20item%20in%20self.str_to_int%20else%20%22%3C%7Cunk%7C%3E%22%20for%20item%20in%20preprocessed%0A%20%20%20%20%20%20%20%20%5D%0A%0A%20%20%20%20%20%20%20%20ids%20%3D%20%5Bself.str_to_int%5Bs%5D%20for%20s%20in%20preprocessed%5D%0A%20%20%20%20%20%20%20%20return%20ids%0A%0A%20%20%20%20def%20decode(self%2C%20ids)%3A%0A%20%20%20%20%20%20%20%20text%20%3D%20%22%20%22.join(%5Bself.int_to_str%5Bi%5D%20for%20i%20in%20ids%5D)%0A%20%20%20%20%20%20%20%20%23%20Replace%20spaces%20before%20the%20specified%20punctuations%0A%20%20%20%20%20%20%20%20text%20%3D%20re.sub(r'%5Cs%2B(%5B%2C.%3A%3B%3F!%22()%5C'%5D)'%2C%20r%22%5C1%22%2C%20text)%0A%20%20%20%20%20%20%20%20return%20text%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Try%20to%20tokenize%20concatenated%20texts%20by%20the%20special%20token.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(vocab_extended)%3A%0A%20%20%20%20tokenizer_extended%20%3D%20SimpleTokenizerV2(vocab_extended)%0A%0A%20%20%20%20_text1%20%3D%20%22Hello%2C%20do%20you%20like%20tea%3F%22%0A%20%20%20%20_text2%20%3D%20%22In%20the%20sunlit%20terraces%20of%20the%20palace.%22%0A%0A%20%20%20%20text_extended%20%3D%20%22%20%3C%7Cendoftext%7C%3E%20%22.join((_text1%2C%20_text2))%0A%0A%20%20%20%20print(text_extended)%0A%20%20%20%20return%20text_extended%2C%20tokenizer_extended%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Then%2C%20tokenize%20it.%20You%20will%20see%20token%20ID%201130%20and%201131%20that%20are%20asigned%20for%20the%20special%20tokens.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(text_extended%2C%20tokenizer_extended)%3A%0A%20%20%20%20tokenizer_extended.encode(text_extended)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Decode%20it%20to%20check%20the%20tokenization.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(text_extended%2C%20tokenizer_extended)%3A%0A%20%20%20%20tokenizer_extended.decode(tokenizer_extended.encode(text_extended))%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%202.5%20BytePair%20encoding%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20To%20avoid%20unknown%20tokens%2C%20introduce%20byte%20pair%20encoding%20(BPE)%20by%20using%20tiktoken.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20print(%22tiktoken%20version%3A%22%2C%20importlib.metadata.version(%22tiktoken%22))%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Try%20the%20tiktoken%20tokenizer%20for%20GPT2%20model.%20The%20max%20token%20ID%2050256%20is%20assigned%20for%20%60endoftext%60.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20bpe_tokenizer%20%3D%20tiktoken.get_encoding(%22gpt2%22)%0A%0A%20%20%20%20text_5%20%3D%20(%0A%20%20%20%20%20%20%20%20%22Hello%2C%20do%20you%20like%20tea%3F%20%3C%7Cendoftext%7C%3E%20In%20the%20sunlit%20terraces%22%0A%20%20%20%20%20%20%20%20%20%22of%20someunknownPlace.%22%0A%20%20%20%20)%0A%0A%20%20%20%20bpe_token_id_5%20%3D%20bpe_tokenizer.encode(text_5%2C%20allowed_special%3D%7B%22%3C%7Cendoftext%7C%3E%22%7D)%0A%0A%20%20%20%20print(bpe_token_id_5)%0A%20%20%20%20return%20bpe_token_id_5%2C%20bpe_tokenizer%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Check%20it%20by%20using%20the%20decoding.%20It%20encodes%20all%20tokens%20in%20unique%20manner%20by%20using%20subworkds%20and%20the%20combined%20words.%20So%2C%20this%20is%20invertive.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(bpe_token_id_5%2C%20bpe_tokenizer)%3A%0A%20%20%20%20_strings%20%3D%20bpe_tokenizer.decode(bpe_token_id_5)%0A%20%20%20%20print(_strings)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20To%20know%20BPE%2C%20see%20%5Bthis%5D(..%2F..%2Fthird_party%2FLLMs-from-scratch%2Fch02%2F05_bpe-from-scratch%2Fbpe-from-scratch.ipynb).%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%202.6%20Data%20sampling%20with%20a%20sliding%20window%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Use%20BPE%20tokenizer%20for%20tokenization%20of%20The%20Verdict%2C%20and%20show%20the%20size%20of%20the%20all%20tokens.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(bpe_tokenizer%2C%20raw_text)%3A%0A%20%20%20%20enc_text%20%3D%20bpe_tokenizer.encode(raw_text)%0A%20%20%20%20print(len(enc_text))%0A%20%20%20%20return%20(enc_text%2C)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Delete%20the%20beginning%20for%20a%20later%20demonstration.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(enc_text)%3A%0A%20%20%20%20enc_sample%20%3D%20enc_text%5B50%3A%5D%0A%20%20%20%20return%20(enc_sample%2C)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Create%20learning%20pairs%20to%20predict%20next%20tokens.%20The%20task%20is%20predicting%20the%20%60y%60%20from%20the%20%60x%60.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(enc_sample)%3A%0A%20%20%20%20context_size%20%3D%204%0A%0A%20%20%20%20x%20%3D%20enc_sample%5B%3Acontext_size%5D%0A%20%20%20%20y%20%3D%20enc_sample%5B1%3Acontext_size%2B1%5D%0A%0A%20%20%20%20print(f%22x%3A%20%7Bx%7D%22)%0A%20%20%20%20print(f%22y%3A%20%20%20%20%20%20%7By%7D%22)%0A%20%20%20%20return%20(context_size%2C)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20The%20mappings%20will%20be%20learned%20are%20these.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(context_size%2C%20enc_sample)%3A%0A%20%20%20%20for%20_i%20in%20range(1%2C%20context_size%2B1)%3A%0A%20%20%20%20%20%20%20%20_context%20%3D%20enc_sample%5B%3A_i%5D%0A%20%20%20%20%20%20%20%20_desired%20%3D%20enc_sample%5B_i%5D%0A%0A%20%20%20%20%20%20%20%20print(_context%2C%20%22----%3E%22%2C%20_desired)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Decode%20these%20token%20IDs%20to%20check%20the%20words.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(bpe_tokenizer%2C%20context_size%2C%20enc_sample)%3A%0A%20%20%20%20for%20_i%20in%20range(1%2C%20context_size%2B1)%3A%0A%20%20%20%20%20%20%20%20_context%20%3D%20enc_sample%5B%3A_i%5D%0A%20%20%20%20%20%20%20%20_desired%20%3D%20enc_sample%5B_i%5D%0A%0A%20%20%20%20%20%20%20%20print(bpe_tokenizer.decode(_context)%2C%20%22----%3E%22%2C%20bpe_tokenizer.decode(%5B_desired%5D))%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Let's%20define%20dataset%20for%20this%20by%20using%20PyTorch.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20print(%22PyTorch%20version%3A%22%2C%20torch.__version__)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20To%20define%20PyTorch%20dataset%2C%20we%20need%20to%20define%20special%20methods%20%60__len__%60%20and%20%60__getitem__%60%20for%20iterater%20use.%20We%20implement%20the%20indexing%20for%20tokenized%20tensor%20with%20chunks%20whose%20size%20is%20%60max_length%60%20with%20%60stride%60%20step%20size%20(sliding%20window).%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.class_definition%0Aclass%20GPTDatasetV1(Dataset)%3A%0A%20%20%20%20def%20__init__(self%2C%20txt%2C%20bpe_tokenizer%2C%20max_length%2C%20stride)%3A%0A%20%20%20%20%20%20%20%20self.input_ids%20%3D%20%5B%5D%0A%20%20%20%20%20%20%20%20self.target_ids%20%3D%20%5B%5D%0A%0A%20%20%20%20%20%20%20%20%23%20Tokenize%20the%20entire%20text%0A%20%20%20%20%20%20%20%20token_ids%20%3D%20bpe_tokenizer.encode(txt%2C%20allowed_special%3D%7B%22%3C%7Cendoftext%7C%3E%22%7D)%0A%20%20%20%20%20%20%20%20assert%20len(token_ids)%20%3E%20max_length%2C%20(%0A%20%20%20%20%20%20%20%20%20%20%20%20%22Number%20of%20tokenized%20inputs%20must%20at%20least%20be%20equal%20to%20max_length%2B1%22%0A%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20%23%20Use%20a%20sliding%20window%20to%20chunk%20the%20book%20into%20overlapping%20sequences%20of%20max_length%0A%20%20%20%20%20%20%20%20for%20i%20in%20range(0%2C%20len(token_ids)%20-%20max_length%2C%20stride)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20input_chunk%20%3D%20token_ids%5Bi%20%3A%20i%20%2B%20max_length%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20target_chunk%20%3D%20token_ids%5Bi%20%2B%201%20%3A%20i%20%2B%20max_length%20%2B%201%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20self.input_ids.append(torch.tensor(input_chunk))%0A%20%20%20%20%20%20%20%20%20%20%20%20self.target_ids.append(torch.tensor(target_chunk))%0A%0A%20%20%20%20def%20__len__(self)%3A%0A%20%20%20%20%20%20%20%20return%20len(self.input_ids)%0A%0A%20%20%20%20def%20__getitem__(self%2C%20idx)%3A%0A%20%20%20%20%20%20%20%20return%20self.input_ids%5Bidx%5D%2C%20self.target_ids%5Bidx%5D%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Define%20a%20function%20to%20instantiate%20the%20dataloader%20class.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.function%0Adef%20create_dataloader_v1(%0A%20%20%20%20txt%2C%0A%20%20%20%20batch_size%3D4%2C%0A%20%20%20%20max_length%3D256%2C%0A%20%20%20%20stride%3D128%2C%0A%20%20%20%20shuffle%3DTrue%2C%0A%20%20%20%20drop_last%3DTrue%2C%0A%20%20%20%20num_workers%3D0%2C%0A)%3A%0A%20%20%20%20%23%20Initialize%20the%20tokenizer%0A%20%20%20%20bpe_tokenizer%20%3D%20tiktoken.get_encoding(%22gpt2%22)%0A%0A%20%20%20%20%23%20Create%20dataset%0A%20%20%20%20dataset%20%3D%20GPTDatasetV1(txt%2C%20bpe_tokenizer%2C%20max_length%2C%20stride)%0A%0A%20%20%20%20%23%20Create%20dataloader%0A%20%20%20%20dataloader%20%3D%20DataLoader(%0A%20%20%20%20%20%20%20%20dataset%2C%0A%20%20%20%20%20%20%20%20batch_size%3Dbatch_size%2C%0A%20%20%20%20%20%20%20%20shuffle%3Dshuffle%2C%0A%20%20%20%20%20%20%20%20drop_last%3Ddrop_last%2C%0A%20%20%20%20%20%20%20%20num_workers%3Dnum_workers%2C%0A%20%20%20%20)%0A%0A%20%20%20%20return%20dataloader%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20For%20debugging%2C%20define%20a%20decoder%20function%20for%20batches.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.function%0Adef%20decode_batch(batch%2C%20tokenizer)%3A%0A%20%20%20%20inputs%2C%20targets%20%3D%20batch%0A%20%20%20%20batch_size%2C%20seq_length%20%3D%20inputs.shape%0A%0A%20%20%20%20decoded_inputs%20%3D%20%5B%5D%0A%20%20%20%20decoded_targets%20%3D%20%5B%5D%0A%0A%20%20%20%20for%20i%20in%20range(batch_size)%3A%0A%20%20%20%20%20%20%20%20input_ids%20%3D%20inputs%5Bi%5D.tolist()%0A%20%20%20%20%20%20%20%20target_ids%20%3D%20targets%5Bi%5D.tolist()%0A%0A%20%20%20%20%20%20%20%20decoded_input%20%3D%20tokenizer.decode(input_ids)%0A%20%20%20%20%20%20%20%20decoded_target%20%3D%20tokenizer.decode(target_ids)%0A%0A%20%20%20%20%20%20%20%20decoded_inputs.append(decoded_input)%0A%20%20%20%20%20%20%20%20decoded_targets.append(decoded_target)%0A%0A%20%20%20%20return%20decoded_inputs%2C%20decoded_targets%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Call%20the%20function%20to%20check%20the%20data%20batches.%20The%20output%20should%20be%20the%20pair%20of%20input%20IDs%20and%20target%20IDs.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(bpe_tokenizer%2C%20raw_text)%3A%0A%20%20%20%20_dataloader_s1%20%3D%20create_dataloader_v1(%0A%20%20%20%20%20%20%20%20raw_text%2C%20batch_size%3D1%2C%20max_length%3D4%2C%20stride%3D1%2C%20shuffle%3DFalse%0A%20%20%20%20)%0A%0A%20%20%20%20data_iter_s1%20%3D%20iter(_dataloader_s1)%0A%20%20%20%20_first_batch%20%3D%20next(data_iter_s1)%0A%20%20%20%20print(f%22%7B_first_batch%3D%7D%22)%0A%0A%20%20%20%20_inputs_decoded%2C%20_targets_decoded%20%3D%20decode_batch(_first_batch%2C%20bpe_tokenizer)%0A%20%20%20%20print(f%22%7B_inputs_decoded%3D%7D%22)%0A%20%20%20%20print(f%22%7B_targets_decoded%3D%7D%22)%0A%20%20%20%20return%20(data_iter_s1%2C)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Iterate%20again%20and%20check%20the%20next%20batch.%20You%20will%20see%20only%201%20shifted%20tokens%20from%20the%20previous%20because%20of%20%60stride%3D1%60.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(bpe_tokenizer%2C%20data_iter_s1)%3A%0A%20%20%20%20_second_batch%20%3D%20next(data_iter_s1)%0A%20%20%20%20print(f%22%7B_second_batch%3D%7D%22)%0A%0A%20%20%20%20_inputs_decoded%2C%20_targets_decoded%20%3D%20decode_batch(_second_batch%2C%20bpe_tokenizer)%0A%20%20%20%20print(f%22%7B_inputs_decoded%3D%7D%22)%0A%20%20%20%20print(f%22%7B_targets_decoded%3D%7D%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Try%20larger%20batch%20size%20(%60batch_size%3D8%60)%20for%20robust%20training.%20To%20avoid%20overfitting%2C%20the%20stride%20is%20also%20increased%20(%60stride%3D4%60).%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(bpe_tokenizer%2C%20raw_text)%3A%0A%20%20%20%20_dataloader_s4%20%3D%20create_dataloader_v1(%0A%20%20%20%20%20%20%20%20raw_text%2C%20batch_size%3D8%2C%20max_length%3D4%2C%20stride%3D4%2C%20shuffle%3DFalse%0A%20%20%20%20)%0A%0A%20%20%20%20data_iter_s4%20%3D%20iter(_dataloader_s4)%0A%20%20%20%20_inputs%2C%20_targets%20%3D%20next(data_iter_s4)%0A%20%20%20%20print(%22Inputs%3A%5Cn%22%2C%20_inputs)%0A%20%20%20%20print(%22%5CnTargets%3A%5Cn%22%2C%20_targets)%0A%0A%20%20%20%20_inputs_decoded%2C%20_targets_decoded%20%3D%20decode_batch((_inputs%2C%20_targets)%2C%20bpe_tokenizer)%0A%20%20%20%20print(f%22%7B_inputs_decoded%3D%7D%22)%0A%20%20%20%20print(f%22%7B_targets_decoded%3D%7D%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%202.7%20Creating%20token%20embeddings%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20This%20is%20an%20example%20for%20token%20embeddings%20that%20accepts%206-dimensional%20input%20as%20the%20vocabulary%20and%20outputs%203-dimensional%20embedding%20vector.%0A%0A%20%20%20%20The%20embedding%20is%20represented%20by%20a%20matrix%20whose%20rows%20represents%20embedding%20vectors%20for%20each%20vocabularies.%0A%0A%20%20%20%20The%20representation%20matrix%20can%20be%20trained.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20_vocab_size%20%3D%206%0A%20%20%20%20_output_dim%20%3D%203%0A%0A%20%20%20%20torch.manual_seed(123)%0A%20%20%20%20%23%20randomly%20initizalize%20embedding%20layer%0A%20%20%20%20embedding_layer%20%3D%20torch.nn.Embedding(_vocab_size%2C%20_output_dim)%0A%20%20%20%20print(embedding_layer.weight)%0A%20%20%20%20return%20(embedding_layer%2C)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Let's%20try%20the%20embedding%20for%20token%20ID%203.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(embedding_layer)%3A%0A%20%20%20%20print(embedding_layer(torch.tensor(%5B3%5D)))%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Try%20more%20embeddings.%20This%20is%20just%20referring%20the%20matrix%20as%20LUT%20(Look%20Up%20Table).%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(embedding_layer)%3A%0A%20%20%20%20_input_ids%20%3D%20torch.tensor(%5B2%2C%203%2C%205%2C%201%5D)%0A%20%20%20%20print(embedding_layer(_input_ids))%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20%23%23%202.8%20Encoding%20word%20positions%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Try%20positional%20encoding%20based%20on%20this%20configurations.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20_vocab_size%20%3D%2050257%0A%20%20%20%20output_dim%20%3D%20256%0A%0A%20%20%20%20token_embedding_layer%20%3D%20torch.nn.Embedding(_vocab_size%2C%20output_dim)%0A%20%20%20%20return%20output_dim%2C%20token_embedding_layer%0A%0A%0A%40app.cell%0Adef%20_(raw_text)%3A%0A%20%20%20%20max_length%20%3D%204%0A%20%20%20%20dataloader%20%3D%20create_dataloader_v1(%0A%20%20%20%20%20%20%20%20raw_text%2C%20batch_size%3D8%2C%20max_length%3Dmax_length%2C%0A%20%20%20%20%20%20%20%20stride%3Dmax_length%2C%20shuffle%3DFalse%0A%20%20%20%20)%0A%20%20%20%20data_iter%20%3D%20iter(dataloader)%0A%20%20%20%20inputs%2C%20targets%20%3D%20next(data_iter)%0A%20%20%20%20return%20inputs%2C%20max_length%0A%0A%0A%40app.cell%0Adef%20_(inputs)%3A%0A%20%20%20%20print(%22Token%20IDs%3A%5Cn%22%2C%20inputs)%0A%20%20%20%20print(%22%5CnInputs%20shape%3A%5Cn%22%2C%20inputs.shape)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Then%2C%20these%20tokens%20are%20embedded%20to%20256-dimensional%20manifold.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(inputs%2C%20token_embedding_layer)%3A%0A%20%20%20%20token_embeddings%20%3D%20token_embedding_layer(inputs)%0A%20%20%20%20print(token_embeddings.shape)%0A%0A%20%20%20%20%23%20uncomment%20%26%20execute%20the%20following%20line%20to%20see%20how%20the%20embeddings%20look%20like%0A%20%20%20%20%23%20print(token_embeddings)%0A%20%20%20%20return%20(token_embeddings%2C)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Absolute%20positional%20embedding%20is%20also%20proceeded%20by%20using%20another%20%60torch.nn.Embedding%60%20layer.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(max_length%2C%20output_dim)%3A%0A%20%20%20%20context_length%20%3D%20max_length%0A%20%20%20%20pos_embedding_layer%20%3D%20torch.nn.Embedding(context_length%2C%20output_dim)%0A%0A%20%20%20%20%23%20uncomment%20%26%20execute%20the%20following%20line%20to%20see%20how%20the%20embedding%20layer%20weights%20look%20like%0A%20%20%20%20print(pos_embedding_layer.weight)%0A%20%20%20%20return%20(pos_embedding_layer%2C)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20Then%2C%20indexes%20represents%20absolute%20positions%20are%20input%20to%20it.%20This%20can%20be%20also%20interpreted%20as%20LUT.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(max_length%2C%20pos_embedding_layer)%3A%0A%20%20%20%20pos_embeddings%20%3D%20pos_embedding_layer(torch.arange(max_length))%0A%20%20%20%20print(pos_embeddings.shape)%0A%0A%20%20%20%20%23%20uncomment%20%26%20execute%20the%20following%20line%20to%20see%20how%20the%20embeddings%20look%20like%0A%20%20%20%20print(pos_embeddings)%20%0A%20%20%20%20return%20(pos_embeddings%2C)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20mo.md(r%22%22%22%0A%20%20%20%20The%20absolute%20positional%20encoding%20is%20just%20adding%20these.%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(pos_embeddings%2C%20token_embeddings)%3A%0A%20%20%20%20input_embeddings%20%3D%20token_embeddings%20%2B%20pos_embeddings%0A%20%20%20%20print(input_embeddings.shape)%0A%0A%20%20%20%20%23%20uncomment%20%26%20execute%20the%20following%20line%20to%20see%20how%20the%20embeddings%20look%20like%0A%20%20%20%20print(input_embeddings)%0A%20%20%20%20return%0A%0A%0Aif%20__name__%20%3D%3D%20%22__main__%22%3A%0A%20%20%20%20app.run()%0A
</marimo-code>

<marimo-code-hash hidden="">f1f637e55fe31ce7167d9a969aea7f39</marimo-code-hash>
</body>
</html>
